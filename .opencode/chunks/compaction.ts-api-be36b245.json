{
  "id": "compaction.ts-api-be36b245",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-supermemory/src/services/compaction.ts",
  "chunk_type": "api",
  "content": "# API Surface: compaction.ts\n\n## Public Functions\n\n### createCompactionHook\n```typescript\nexport function createCompactionHook(\n  ctx: CompactionContext,\n  tags:\n```\nNo documentation found\n\n**Parameters:**\n- `ctx`: CompactionContext - \n- `tags`: { user: string; project: string } - \n- `options`: CompactionOptions - \n\n**Returns:** void\n\n\n## Classes\n\n\n## Interfaces\n\n### CompactionState\n```typescript\ninterface CompactionState\n```\nNo documentation found\n\n\n### TokenInfo\n```typescript\ninterface TokenInfo\n```\nNo documentation found\n\n\n### MessageInfo\n```typescript\ninterface MessageInfo\n```\nNo documentation found\n\n\n### StoredMessage\n```typescript\ninterface StoredMessage\n```\nNo documentation found\n\n\n### SummarizeContext\n```typescript\ninterface SummarizeContext\n```\nNo documentation found\n\n\n### CompactionOptions\n```typescript\nexport interface CompactionOptions\n```\nNo documentation found\n\n\n### CompactionContext\n```typescript\nexport interface CompactionContext\n```\nNo documentation found\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.368Z",
    "updated_at": "2026-01-30T05:26:52.368Z",
    "hash": "580a22d2613475d0e87b676d307b9b5b9daee3a99464ad3afd777bd45f3f8000",
    "dependencies": [
      "node:fs",
      "node:path",
      "node:os",
      "./client.js",
      "./logger.js",
      "../config.js"
    ],
    "symbols": [
      "MESSAGE_STORAGE",
      "PART_STORAGE",
      "DEFAULT_THRESHOLD",
      "MIN_TOKENS_FOR_COMPACTION",
      "COMPACTION_COOLDOWN_MS",
      "DEFAULT_CONTEXT_LIMIT",
      "CompactionState",
      "TokenInfo",
      "MessageInfo",
      "StoredMessage",
      "SummarizeContext",
      "CompactionOptions",
      "createCompactionPrompt",
      "memoriesSection",
      "getMessageDir",
      "directPath",
      "dir",
      "sessionPath",
      "getOrCreateMessageDir",
      "directPath",
      "dir",
      "sessionPath",
      "findNearestMessageWithFields",
      "files",
      "file",
      "content",
      "msg",
      "generateMessageId",
      "timestamp",
      "random",
      "generatePartId",
      "timestamp",
      "random",
      "injectHookMessage",
      "messageDir",
      "fallback",
      "now",
      "messageID",
      "partID",
      "resolvedAgent",
      "resolvedModel",
      "messageMeta",
      "textPart",
      "partDir",
      "err",
      "CompactionContext",
      "createCompactionHook",
      "state",
      "threshold",
      "getModelLimit",
      "fetchProjectMemoriesForCompaction",
      "result",
      "memories",
      "err",
      "injectCompactionContext",
      "projectMemories",
      "prompt",
      "success",
      "saveSummaryAsMemory",
      "result",
      "err",
      "checkAndTriggerCompaction",
      "lastCompaction",
      "tokens",
      "modelID",
      "providerID",
      "agent",
      "messageDir",
      "storedMessage",
      "configLimit",
      "contextLimit",
      "totalUsed",
      "usageRatio",
      "messageDir",
      "storedMessage",
      "err",
      "handleSummaryMessage",
      "resp",
      "messages",
      "summaryMessage",
      "textParts",
      "summaryContent",
      "err",
      "props",
      "sessionInfo",
      "info",
      "sessionID",
      "sessionID",
      "resp",
      "messages",
      "assistants",
      "lastAssistant",
      "messageDir",
      "storedMessage"
    ],
    "complexity_score": 100
  }
}