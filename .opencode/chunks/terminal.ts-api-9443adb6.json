{
  "id": "terminal.ts-api-9443adb6",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-worktree/src/plugin/worktree/terminal.ts",
  "chunk_type": "api",
  "content": "# API Surface: terminal.ts\n\n## Public Functions\n\n### withTempScript\n```typescript\nexport async function withTempScript<T>(\n\tscriptContent: string,\n\tfn: (scriptPath: string) => Promise<T>,\n\textension: string = \".sh\",\n\tclient?: OpencodeClient,\n): Promise<T>\n```\nExecute a function with a temporary script file that is guaranteed to be cleaned up.\nUses try-finally pattern to ensure cleanup even on errors.\n\n**Parameters:**\n- `scriptContent`: string - \n- `fn`: (scriptPath: string) => Promise<T> - \n- `extension`: string - \n- `client`: OpencodeClient - \n\n**Returns:** Promise<T>\n\n\n### detectTerminalType\n```typescript\nexport function detectTerminalType(): TerminalType\n```\nDetect the best terminal type for the current platform.\nPriority: tmux > WSL > platform-specific\n\n**Returns:** TerminalType\n\n\n### openTmuxWindow\n```typescript\nexport async function openTmuxWindow(options:\n```\nOpen a new tmux window with mutex protection.\nIncludes stabilization delay after spawning to prevent races.\n\nSECURITY NOTE: Branch names and paths are passed via array-based spawn\n(Bun.spawnSync with array arguments), NOT shell string interpolation.\nThis prevents command injection even if values contain special characters.\nThe tmux `-n` flag treats its argument as a literal window name string.\n\n**Parameters:**\n- `options`: {\n\tsessionName?: string\n\twindowName: string\n\tcwd: string\n\tcommand?: string\n} - \n\n**Returns:** Promise<TerminalResult>\n\n\n### openMacOSTerminal\n```typescript\nexport async function openMacOSTerminal(cwd: string, command?: string): Promise<TerminalResult>\n```\nOpen terminal on macOS (Terminal.app, iTerm, Ghostty, etc.)\nDetects current terminal and uses appropriate method.\n\n**Parameters:**\n- `cwd`: string - \n- `command`: string - \n\n**Returns:** Promise<TerminalResult>\n\n\n### openLinuxTerminal\n```typescript\nexport async function openLinuxTerminal(cwd: string, command?: string): Promise<TerminalResult>\n```\nOpen terminal on Linux with desktop environment detection.\nPriority: current terminal > xdg-terminal-exec > x-terminal-emulator > modern > DE > xterm\n\nNOTE: All Linux terminal spawns are detached, so we write the script directly\ninstead of using withTempScript. The script self-deletes via trap.\n\n**Parameters:**\n- `cwd`: string - \n- `command`: string - \n\n**Returns:** Promise<TerminalResult>\n\n\n### openWindowsTerminal\n```typescript\nexport async function openWindowsTerminal(cwd: string, command?: string): Promise<TerminalResult>\n```\nOpen terminal on Windows (Windows Terminal or cmd).\nTries Windows Terminal (wt.exe) first, falls back to cmd.exe.\n\nNOTE: All Windows terminal spawns are detached, so we write the script directly\ninstead of using withTempScript. The script self-deletes via goto trick.\n\n**Parameters:**\n- `cwd`: string - \n- `command`: string - \n\n**Returns:** Promise<TerminalResult>\n\n\n### openWSLTerminal\n```typescript\nexport async function openWSLTerminal(cwd: string, command?: string): Promise<TerminalResult>\n```\nOpen terminal in WSL via Windows Terminal interop.\nFalls back to bash in current terminal if wt.exe not available.\n\nNOTE: All WSL terminal spawns are detached, so we write the script directly\ninstead of using withTempScript. The script self-deletes via trap.\n\n**Parameters:**\n- `cwd`: string - \n- `command`: string - \n\n**Returns:** Promise<TerminalResult>\n\n\n### openTerminal\n```typescript\nexport async function openTerminal(\n\tcwd: string,\n\tcommand?: string,\n\twindowName?: string,\n): Promise<TerminalResult>\n```\nOpen a terminal window on the current platform.\nAutomatically detects the best terminal type and method.\n\n**Parameters:**\n- `cwd`: string - \n- `command`: string - \n- `windowName`: string - \n\n**Returns:** Promise<TerminalResult>\n\n\n## Classes\n\n\n## Interfaces\n\n### TerminalResult\n```typescript\nexport interface TerminalResult\n```\nResult of a terminal operation\n\n\n## Types\n\n### TerminalType\n```typescript\nexport type TerminalType\n```\nTerminal type for the current platform\n\n\n### LinuxTerminal\n```typescript\ntype LinuxTerminal\n```\nNo documentation found\n\n\n### MacTerminal\n```typescript\ntype MacTerminal\n```\nNo documentation found\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.392Z",
    "updated_at": "2026-01-30T05:26:52.392Z",
    "hash": "e1a1e78b5996fc07c024df924d09ab2ee5a8da409346eb90e5b0cd10af79da81",
    "dependencies": [
      "node:fs/promises",
      "node:os",
      "node:path",
      "zod",
      "../kdco-primitives",
      "../kdco-primitives"
    ],
    "symbols": [
      "withTempScript",
      "scriptPath",
      "cleanupError",
      "wrapWithSelfCleanup",
      "wrapBatchWithSelfCleanup",
      "TerminalType",
      "TerminalResult",
      "tmuxMutex",
      "STABILIZATION_DELAY_MS",
      "wslEnvSchema",
      "linuxTerminalEnvSchema",
      "macTerminalEnvSchema",
      "LinuxTerminal",
      "MacTerminal",
      "isInsideWSL",
      "parsed",
      "detectTerminalType",
      "openTmuxWindow",
      "tmuxArgs",
      "scriptPath",
      "escapedCwd",
      "escapedCommand",
      "scriptContent",
      "createResult",
      "error",
      "detectCurrentMacTerminal",
      "env",
      "termProgram",
      "openMacOSTerminal",
      "escapedCwd",
      "escapedCommand",
      "scriptContent",
      "terminal",
      "detachedScriptPath",
      "proc",
      "error",
      "remoteResult",
      "result",
      "kittyProc",
      "alacrittyProc",
      "warpProc",
      "escapedPath",
      "appleScript",
      "result",
      "proc",
      "exitCode",
      "stderr",
      "error",
      "detectCurrentLinuxTerminal",
      "env",
      "termProgram",
      "openLinuxTerminal",
      "escapedCwd",
      "escapedCommand",
      "scriptContent",
      "scriptPath",
      "tryTerminal",
      "check",
      "proc",
      "currentTerminal",
      "result",
      "kittyRemote",
      "xdgResult",
      "xteResult",
      "modernTerminals",
      "result",
      "deTerminals",
      "result",
      "xtermResult",
      "error",
      "openWindowsTerminal",
      "escapedCwd",
      "escapedCommand",
      "scriptContent",
      "scriptPath",
      "wtCheck",
      "proc",
      "proc",
      "error",
      "error",
      "openWSLTerminal",
      "escapedCwd",
      "escapedCommand",
      "scriptContent",
      "scriptPath",
      "wtResult",
      "proc",
      "proc",
      "error",
      "error",
      "openTerminal",
      "terminalType"
    ],
    "complexity_score": 100
  }
}