{
  "id": "request-helpers.ts-invariant-c9f62bde",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/request-helpers.ts",
  "chunk_type": "invariant",
  "content": "# Invariants: request-helpers.ts\n\n## Core Invariants\n\n\n## Constraints\n- **ANTIGRAVITY_PREVIEW_LINK**: \"https://goo.gle/enable-preview-features\"\n- **UNSUPPORTED_CONSTRAINTS**: [\n  \"minLength\", \"maxLength\", \"exclusiveMinimum\", \"exclusiveMaximum\",\n  \"pattern\", \"minItems\", \"maxItems\", \"format\",\n  \"default\", \"examples\",\n] as const\n- **UNSUPPORTED_KEYWORDS**: [\n  ...UNSUPPORTED_CONSTRAINTS,\n  \"$schema\", \"$defs\", \"definitions\", \"const\", \"$ref\", \"additionalProperties\",\n  \"propertyNames\", \"title\", \"$id\", \"$comment\",\n] as const\n- **DEFAULT_THINKING_BUDGET**: 16000\n- **SKIP_PARSE_KEYS**: new Set([\n  \"oldString\",\n  \"newString\",\n  \"content\",\n  \"filePath\",\n  \"path\",\n  \"text\",\n  \"code\",\n  \"source\",\n  \"data\",\n  \"body\",\n  \"message\",\n  \"prompt\",\n  \"input\",\n  \"output\",\n  \"result\",\n  \"value\",\n  \"query\",\n  \"pattern\",\n  \"replacement\",\n  \"template\",\n  \"script\",\n  \"command\",\n  \"snippet\",\n])\n\n## Assumptions\n- **Code Annotation**: TODO: Update to Antigravity link if available\n\n## State Management\nNo explicit state management patterns detected\n\n## Error Handling\nError handling metrics: 8 try-catch blocks, 0 throw statements\n\n## Performance Considerations\nPerformance patterns: Contains explicit loops\n\n## Security Considerations\nNo obvious security risks detected via static analysis",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.018Z",
    "updated_at": "2026-01-30T05:26:52.018Z",
    "hash": "b1e6cb0a7497dab114a49091f0f3064be2537d7bbb6024385304c67d05a61383",
    "dependencies": [
      "./config",
      "./logger",
      "../constants",
      "./image-saver",
      "./transform/types"
    ],
    "symbols": [
      "log",
      "ANTIGRAVITY_PREVIEW_LINK",
      "UNSUPPORTED_CONSTRAINTS",
      "UNSUPPORTED_KEYWORDS",
      "appendDescriptionHint",
      "existing",
      "newDescription",
      "convertRefsToHints",
      "refVal",
      "defName",
      "hint",
      "existingDesc",
      "newDescription",
      "result",
      "convertConstToEnum",
      "result",
      "addEnumHints",
      "result",
      "vals",
      "addAdditionalPropertiesHints",
      "result",
      "moveConstraintsToDescription",
      "result",
      "constraint",
      "mergeAllOf",
      "result",
      "merged",
      "mergedRequired",
      "item",
      "req",
      "existingRequired",
      "scoreSchemaOption",
      "type",
      "tryMergeEnumFromUnion",
      "enumValues",
      "option",
      "val",
      "flattenAnyOfOneOf",
      "result",
      "unionKey",
      "options",
      "parentDesc",
      "mergedEnum",
      "bestIdx",
      "bestScore",
      "allTypes",
      "i",
      "selected",
      "childDesc",
      "uniqueTypes",
      "hint",
      "flattenTypeArrays",
      "result",
      "localNullableFields",
      "types",
      "hasNull",
      "nonNullTypes",
      "firstType",
      "newProps",
      "propPath",
      "processed",
      "objectPath",
      "existing",
      "nullableAtRoot",
      "removeUnsupportedKeywords",
      "result",
      "propertiesResult",
      "cleanupRequiredFields",
      "result",
      "validRequired",
      "addEmptySchemaPlaceholder",
      "result",
      "isObjectType",
      "hasProperties",
      "cleanJSONSchemaForAntigravity",
      "result",
      "AntigravityApiError",
      "AntigravityApiBody",
      "AntigravityUsageMetadata",
      "ThinkingConfig",
      "DEFAULT_THINKING_BUDGET",
      "isThinkingCapableModel",
      "lowerModel",
      "extractThinkingConfig",
      "thinkingConfig",
      "config",
      "anthropicThinking",
      "thinking",
      "VariantThinkingConfig",
      "extractVariantThinkingConfig",
      "google",
      "result",
      "tc",
      "search",
      "resolveThinkingConfig",
      "isThinkingPart",
      "hasSignatureField",
      "isToolBlock",
      "stripAllThinkingBlocks",
      "removeTrailingThinkingBlocks",
      "result",
      "part",
      "isValid",
      "hasValidSignature",
      "signature",
      "getSignature",
      "signature",
      "isOurCachedSignature",
      "text",
      "partSignature",
      "cachedSignature",
      "getThinkingText",
      "maybeText",
      "maybeText",
      "stripCacheControlRecursively",
      "result",
      "sanitizeThinkingPart",
      "textContent",
      "maybeText",
      "hasContent",
      "sanitized",
      "thinkingContent",
      "maybeText",
      "hasContent",
      "sanitized",
      "textContent",
      "maybeText",
      "hasContent",
      "sanitized",
      "findLastAssistantIndex",
      "i",
      "content",
      "filterContentArray",
      "filtered",
      "item",
      "isThinking",
      "hasSignature",
      "existingSignature",
      "hasValidSignature",
      "thinkingText",
      "sentinelPart",
      "sanitized",
      "text",
      "cachedSignature",
      "restoredPart",
      "sanitized",
      "filterUnsignedThinkingBlocks",
      "lastAssistantIdx",
      "isLastAssistant",
      "filteredParts",
      "trimmedParts",
      "isAssistantRole",
      "isLastAssistantContent",
      "filteredContent",
      "trimmedContent",
      "filterMessagesThinkingBlocks",
      "lastAssistantIdx",
      "isAssistantRole",
      "isLastAssistant",
      "filteredContent",
      "trimmedContent",
      "deepFilterThinkingBlocks",
      "visited",
      "walk",
      "obj",
      "transformGeminiCandidate",
      "content",
      "thinkingTexts",
      "transformedParts",
      "transformed",
      "thinkingText",
      "transformed",
      "parsedArgs",
      "result",
      "transformThinkingParts",
      "resp",
      "result",
      "reasoningTexts",
      "transformedContent",
      "block",
      "thinkingText",
      "normalizeThinkingConfig",
      "record",
      "budgetRaw",
      "includeRaw",
      "thinkingBudget",
      "includeThoughts",
      "enableThinking",
      "finalInclude",
      "normalized",
      "parseAntigravityApiBody",
      "parsed",
      "firstObject",
      "extractUsageMetadata",
      "usage",
      "asRecord",
      "toNumber",
      "extractUsageFromSsePayload",
      "lines",
      "line",
      "jsonText",
      "parsed",
      "usage",
      "rewriteAntigravityPreviewAccessError",
      "error",
      "trimmedMessage",
      "messagePrefix",
      "enhancedMessage",
      "needsPreviewAccessOverride",
      "errorMessage",
      "isAntigravityModel",
      "isEmptyResponseBody",
      "parsed",
      "firstCandidate",
      "content",
      "parts",
      "hasContent",
      "firstChoice",
      "message",
      "response",
      "StreamingChunkCounter",
      "createStreamingChunkCounter",
      "count",
      "hasRealContent",
      "isMeaningfulSseLine",
      "data",
      "parsed",
      "candidate",
      "parts",
      "part",
      "SKIP_PARSE_KEYS",
      "recursivelyParseJsonStrings",
      "result",
      "stripped",
      "hasControlCharEscapes",
      "hasIntentionalEscapes",
      "parsed",
      "lastBracket",
      "cleaned",
      "parsed",
      "lastBrace",
      "cleaned",
      "parsed",
      "fixToolResponseGrouping",
      "newContents",
      "pendingGroups",
      "collectedResponses",
      "content",
      "role",
      "parts",
      "responseParts",
      "resp",
      "respId",
      "i",
      "group",
      "groupResponses",
      "resp",
      "funcCalls",
      "callIds",
      "funcNames",
      "group",
      "groupResponses",
      "i",
      "expectedId",
      "expectedName",
      "matchedId",
      "orphanName",
      "orphanResp",
      "placeholder",
      "detectToolIdMismatches",
      "expectedIds",
      "foundIds",
      "content",
      "parts",
      "part",
      "expectedSet",
      "foundSet",
      "missingIds",
      "orphanIds",
      "findOrphanedToolUseIds",
      "toolUseIds",
      "toolResultIds",
      "msg",
      "block",
      "fixClaudeToolPairing",
      "toolUseMap",
      "i",
      "msg",
      "block",
      "toolResultIds",
      "msg",
      "block",
      "orphans",
      "orphansByMsgIndex",
      "orphan",
      "existing",
      "result",
      "i",
      "orphansForMsg",
      "nextMsg",
      "placeholders",
      "removeOrphanedToolUse",
      "validateAndFixClaudeToolPairing",
      "fixed",
      "orphanIds",
      "formatTypeHint",
      "type",
      "enumVals",
      "items",
      "itemType",
      "nestedProps",
      "nestedReq",
      "nestedList",
      "t",
      "req",
      "nestedProps",
      "nestedReq",
      "nestedList",
      "t",
      "req",
      "injectParameterSignatures",
      "declarations",
      "newDeclarations",
      "schema",
      "required",
      "properties",
      "paramList",
      "typeHint",
      "isRequired",
      "sigStr",
      "injectToolHardeningInstruction",
      "existing",
      "parts",
      "instructionPart",
      "parts",
      "assignToolIdsToContents",
      "toolCallCounter",
      "pendingCallIdsByName",
      "newContents",
      "newParts",
      "call",
      "nameKey",
      "queue",
      "matchResponseIdsToContents",
      "newParts",
      "resp",
      "queue",
      "applyToolPairingFixes",
      "contentsFixed",
      "messagesFixed",
      "contentsWithMatchedIds",
      "createSyntheticErrorResponse",
      "messageId",
      "events",
      "body"
    ],
    "complexity_score": 100
  }
}