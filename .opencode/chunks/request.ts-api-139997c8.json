{
  "id": "request.ts-api-139997c8",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/request.ts",
  "chunk_type": "api",
  "content": "# API Surface: request.ts\n\n## Public Functions\n\n### getPluginSessionId\n```typescript\nexport function getPluginSessionId(): string\n```\nGets the stable session ID for this plugin instance.\n\n**Returns:** string\n\n\n### isGenerativeLanguageRequest\n```typescript\nexport function isGenerativeLanguageRequest(input: RequestInfo): input is string\n```\nDetects requests headed to the Google Generative Language API so we can intercept them.\n\n**Parameters:**\n- `input`: RequestInfo - \n\n**Returns:** input is string\n\n\n### prepareAntigravityRequest\n```typescript\nexport function prepareAntigravityRequest(\n  input: RequestInfo,\n  init: RequestInit | undefined,\n  accessToken: string,\n  projectId: string,\n  endpointOverride?: string,\n  headerStyle: HeaderStyle = \"antigravity\",\n  forceThinkingRecovery = false,\n  options?: PrepareRequestOptions,\n):\n```\nNo documentation found\n\n**Parameters:**\n- `input`: RequestInfo - \n- `init`: RequestInit | undefined - \n- `accessToken`: string - \n- `projectId`: string - \n- `endpointOverride`: string - \n- `headerStyle`: HeaderStyle - \n- `forceThinkingRecovery`: any - \n- `options`: PrepareRequestOptions - \n\n**Returns:** {\n  request: RequestInfo;\n  init: RequestInit;\n  streaming: boolean;\n  requestedModel?: string;\n  effectiveModel?: string;\n  projectId?: string;\n  endpoint?: string;\n  sessionId?: string;\n  toolDebugMissing?: number;\n  toolDebugSummary?: string;\n  toolDebugPayload?: string;\n  needsSignedThinkingWarmup?: boolean;\n  headerStyle: HeaderStyle;\n  thinkingRecoveryMessage?: string;\n}\n\n\n### buildThinkingWarmupBody\n```typescript\nexport function buildThinkingWarmupBody(\n  bodyText: string | undefined,\n  isClaudeThinking: boolean,\n): string | null\n```\nNo documentation found\n\n**Parameters:**\n- `bodyText`: string | undefined - \n- `isClaudeThinking`: boolean - \n\n**Returns:** string | null\n\n\n### transformAntigravityResponse\n```typescript\nexport async function transformAntigravityResponse(\n  response: Response,\n  streaming: boolean,\n  debugContext?: AntigravityDebugContext | null,\n  requestedModel?: string,\n  projectId?: string,\n  endpoint?: string,\n  effectiveModel?: string,\n  sessionId?: string,\n  toolDebugMissing?: number,\n  toolDebugSummary?: string,\n  toolDebugPayload?: string,\n  debugLines?: string[],\n): Promise<Response>\n```\nNormalizes Antigravity responses: applies retry headers, extracts cache usage into headers,\nrewrites preview errors, flattens streaming payloads, and logs debug metadata.\n\nFor streaming SSE responses, uses TransformStream for true real-time incremental streaming.\nThinking/reasoning tokens are transformed and forwarded immediately as they arrive.\n\n**Parameters:**\n- `response`: Response - \n- `streaming`: boolean - \n- `debugContext`: AntigravityDebugContext | null - \n- `requestedModel`: string - \n- `projectId`: string - \n- `endpoint`: string - \n- `effectiveModel`: string - \n- `sessionId`: string - \n- `toolDebugMissing`: number - \n- `toolDebugSummary`: string - \n- `toolDebugPayload`: string - \n- `debugLines`: string[] - \n\n**Returns:** Promise<Response>\n\n\n## Classes\n\n\n## Interfaces\n\n### PrepareRequestOptions\n```typescript\nexport interface PrepareRequestOptions\n```\nOptions for request preparation.\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.037Z",
    "updated_at": "2026-01-30T05:26:52.037Z",
    "hash": "e28657c86dbb92f2c985f32fb606a4f3f6e37feaed01a73a80f2da942be4920c",
    "dependencies": [
      "node:crypto",
      "../constants",
      "./cache",
      "./core/streaming",
      "./stores/signature-store",
      "./debug",
      "./logger",
      "./request-helpers",
      "../constants",
      "./thinking-recovery",
      "./transform/cross-model-sanitizer",
      "./transform",
      "./transform",
      "./recovery"
    ],
    "symbols": [
      "log",
      "PLUGIN_SESSION_ID",
      "sessionDisplayedThinkingHashes",
      "MIN_SIGNATURE_LENGTH",
      "buildSignatureSessionKey",
      "modelKey",
      "projectPart",
      "conversationPart",
      "shouldCacheThinkingSignatures",
      "lower",
      "hashConversationSeed",
      "extractTextFromContent",
      "block",
      "anyBlock",
      "extractConversationSeedFromMessages",
      "system",
      "users",
      "firstUser",
      "lastUser",
      "systemText",
      "userText",
      "fallbackUserText",
      "extractConversationSeedFromContents",
      "users",
      "firstUser",
      "lastUser",
      "primaryUser",
      "resolveConversationKey",
      "anyPayload",
      "candidates",
      "candidate",
      "systemSeed",
      "messageSeed",
      "seed",
      "resolveConversationKeyFromRequests",
      "req",
      "key",
      "resolveProjectKey",
      "formatDebugLinesForThinking",
      "cleaned",
      "injectDebugThinking",
      "resp",
      "candidates",
      "first",
      "parts",
      "content",
      "stripInjectedDebugFromParts",
      "record",
      "text",
      "stripInjectedDebugFromRequestPayload",
      "anyPayload",
      "isGeminiToolUsePart",
      "isGeminiThinkingPart",
      "ensureThoughtSignature",
      "text",
      "cached",
      "cached",
      "hasSignedThinkingPart",
      "ensureThinkingBeforeToolUseInContents",
      "role",
      "parts",
      "hasToolUse",
      "thinkingParts",
      "otherParts",
      "hasSignedThinking",
      "lastThinking",
      "injected",
      "ensureMessageThinkingSignature",
      "text",
      "cached",
      "hasToolUseInContents",
      "hasSignedThinkingInContents",
      "hasToolUseInMessages",
      "hasSignedThinkingInMessages",
      "ensureThinkingBeforeToolUseInMessages",
      "blocks",
      "hasToolUse",
      "thinkingBlocks",
      "otherBlocks",
      "hasSignedThinking",
      "lastThinking",
      "existingThinking",
      "thinkingText",
      "sentinelBlock",
      "injected",
      "getPluginSessionId",
      "generateSyntheticProjectId",
      "adjectives",
      "nouns",
      "adj",
      "noun",
      "randomPart",
      "STREAM_ACTION",
      "isGenerativeLanguageRequest",
      "PrepareRequestOptions",
      "prepareAntigravityRequest",
      "baseInit",
      "headers",
      "resolvedProjectId",
      "toolDebugMissing",
      "toolDebugSummaries",
      "toolDebugPayload",
      "sessionId",
      "needsSignedThinkingWarmup",
      "thinkingRecoveryMessage",
      "match",
      "requestedModel",
      "resolved",
      "effectiveModel",
      "streaming",
      "defaultEndpoint",
      "baseEndpoint",
      "transformedUrl",
      "isClaude",
      "isClaudeThinking",
      "tierThinkingBudget",
      "tierThinkingLevel",
      "signatureSessionKey",
      "body",
      "parsedBody",
      "isWrapped",
      "wrappedBody",
      "requestRoot",
      "requestObjects",
      "nested",
      "conversationKey",
      "modelForCacheKey",
      "req",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "requestPayload",
      "rawGenerationConfig",
      "extraBody",
      "variantConfig",
      "isGemini3",
      "toolConfig",
      "isImageModel",
      "userThinkingConfig",
      "hasAssistantHistory",
      "isClaudeSonnetNonThinking",
      "effectiveUserThinkingConfig",
      "imageConfig",
      "generationConfig",
      "finalThinkingConfig",
      "normalizedThinking",
      "thinkingBudget",
      "thinkingConfig",
      "currentMax",
      "generationConfig",
      "hint",
      "existing",
      "sys",
      "partsValue",
      "parts",
      "appended",
      "i",
      "part",
      "partRecord",
      "text",
      "cachedContentFromExtra",
      "cachedContent",
      "functionDeclarations",
      "passthroughTools",
      "normalizeSchema",
      "createPlaceholderSchema",
      "cleaned",
      "hasProperties",
      "pushDeclaration",
      "schema",
      "name",
      "description",
      "finalTools",
      "effectiveSearchConfig",
      "geminiResult",
      "enableToolHardening",
      "conversationKey",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "toolCallCounter",
      "pendingCallIdsByName",
      "newParts",
      "call",
      "nameKey",
      "queue",
      "newParts",
      "resp",
      "queue",
      "conversationState",
      "effectiveProjectId",
      "existingSystemInstruction",
      "sys",
      "firstPart",
      "wrappedBody",
      "error",
      "existing",
      "interleavedHeader",
      "selectedHeaders",
      "buildThinkingWarmupBody",
      "parsed",
      "warmupPrompt",
      "updateRequest",
      "generationConfig",
      "nested",
      "transformAntigravityResponse",
      "contentType",
      "isJsonResponse",
      "isEventStreamResponse",
      "debugText",
      "cacheSignatures",
      "headers",
      "streamingTransformer",
      "headers",
      "text",
      "errorBody",
      "debugInfo",
      "injectedDebug",
      "errorType",
      "recoveryError",
      "errorMessage",
      "retryInfo",
      "match",
      "retrySeconds",
      "retryAfterSec",
      "retryAfterMs",
      "init",
      "usageFromSse",
      "parsed",
      "patched",
      "effectiveBody",
      "usage",
      "responseBody",
      "transformed",
      "error",
      "__testExports"
    ],
    "complexity_score": 100
  }
}