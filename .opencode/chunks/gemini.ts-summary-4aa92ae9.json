{
  "id": "gemini.ts-summary-4aa92ae9",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/transform/gemini.ts",
  "chunk_type": "summary",
  "content": "# Summary: gemini.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nDocumented purpose found in JSDoc\n\n## Key Components\n\n### Functions (11)\n- **toGeminiSchema**: No documentation found\n- **isGeminiModel**: Check if a model is a Gemini model (not Claude).\n- **isGemini3Model**: Check if a model is Gemini 3 (uses thinkingLevel string).\n- **isGemini25Model**: Check if a model is Gemini 2.5 (uses numeric thinkingBudget).\n- **isImageGenerationModel**: Check if a model is an image generation model.\nImage models don't support thinking and require imageConfig.\n- **buildGemini3ThinkingConfig**: Build Gemini 3 thinking config with thinkingLevel string.\n- **buildGemini25ThinkingConfig**: Build Gemini 2.5 thinking config with numeric thinkingBudget.\n- **buildImageGenerationConfig**: Build image generation config for Gemini image models.\n\nConfiguration is read from environment variables:\n- OPENCODE_IMAGE_ASPECT_RATIO: Aspect ratio (e.g., \"16:9\", \"4:3\")\n\nDefaults to 1:1 aspect ratio if not specified.\n\nNote: Resolution setting is not currently supported by the Antigravity API.\n- **normalizeGeminiTools**: Normalize tools for Gemini models.\nEnsures tools have proper function-style format.\n- **applyGeminiTransforms**: Apply all Gemini-specific transformations.\n- **wrapToolsAsFunctionDeclarations**: Wrap tools array in Gemini's required functionDeclarations format.\n\nGemini/Antigravity API expects:\n  { tools: [{ functionDeclarations: [{ name, description, parameters }] }] }\n\nNOT:\n  { tools: [{ function: {...}, parameters: {...} }] }\n\nThe wrapper-level 'parameters' field causes:\n  \"Unknown name 'parameters' at 'request.tools[0]'\"\n\n\n\n\n## Dependencies\n- ./types\n\n## Exports\n- toGeminiSchema\n- isGeminiModel\n- isGemini3Model\n- isGemini25Model\n- isImageGenerationModel\n- buildGemini3ThinkingConfig\n- buildGemini25ThinkingConfig\n- ImageConfig\n- buildImageGenerationConfig\n- normalizeGeminiTools\n- GeminiTransformOptions\n- GeminiTransformResult\n- applyGeminiTransforms\n- WrapToolsResult\n- wrapToolsAsFunctionDeclarations\n\n## Complexity Metrics\n- Lines of code: 536\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.103Z",
    "updated_at": "2026-01-30T05:26:52.103Z",
    "hash": "04d2e9b4904f1c9ab050cdcc128e4dc27287ac81c72d6661189fd48dd1fab41e",
    "dependencies": [
      "./types"
    ],
    "symbols": [
      "UNSUPPORTED_SCHEMA_FIELDS",
      "toGeminiSchema",
      "inputSchema",
      "result",
      "propertyNames",
      "propName",
      "props",
      "validRequired",
      "isGeminiModel",
      "lower",
      "isGemini3Model",
      "isGemini25Model",
      "isImageGenerationModel",
      "lower",
      "buildGemini3ThinkingConfig",
      "buildGemini25ThinkingConfig",
      "ImageConfig",
      "VALID_ASPECT_RATIOS",
      "buildImageGenerationConfig",
      "aspectRatio",
      "normalizeGeminiTools",
      "toolDebugMissing",
      "toolDebugSummaries",
      "t",
      "newTool",
      "schemaCandidates",
      "placeholderSchema",
      "schema",
      "schemaObjectOk",
      "nameCandidate",
      "fn",
      "GeminiTransformOptions",
      "GeminiTransformResult",
      "applyGeminiTransforms",
      "thinkingConfig",
      "thinkingBudget",
      "generationConfig",
      "tools",
      "result",
      "wrapResult",
      "WrapToolsResult",
      "wrapToolsAsFunctionDeclarations",
      "functionDeclarations",
      "passthroughTools",
      "tool",
      "decl",
      "fn",
      "custom",
      "name",
      "description",
      "schema",
      "finalTools"
    ],
    "complexity_score": 100
  }
}