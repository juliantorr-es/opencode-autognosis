{
  "id": "rotation.ts-summary-285d1a87",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/rotation.ts",
  "chunk_type": "summary",
  "content": "# Summary: rotation.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (9)\n- **addJitter**: Add random jitter to a delay value.\nHelps break predictable timing patterns.\n- **randomDelay**: Generate a random delay within a range.\n- **sortByLruWithHealth**: Sort accounts by LRU (least recently used first) with health score tiebreaker.\n\nPriority:\n1. Filter out rate-limited and cooling-down accounts\n2. Filter out unhealthy accounts (score < minUsable)\n3. Sort by lastUsed ascending (oldest first = most rested)\n4. Tiebreaker: higher health score wins\n- **selectHybridAccount**: Select account using hybrid strategy:\n1. Filter available accounts (not rate-limited, not cooling down, healthy, has tokens)\n2. Calculate priority score: health (2x) + tokens (5x) + freshness (0.1x)\n3. Sort by score descending\n4. Return the best candidate (deterministic - highest score)\n- **calculateHybridScore**: No documentation found\n- **getTokenTracker**: No documentation found\n- **initTokenTracker**: No documentation found\n- **getHealthTracker**: Get the global health score tracker instance.\nCreates one with default config if not initialized.\n- **initHealthTracker**: Initialize the global health tracker with custom config.\nCall this at plugin startup if custom config is needed.\n\n\n\n### Classes (2)\n- **HealthScoreTracker**: Tracks health scores for accounts.\nHigher score = healthier account = preferred for selection.\n- **TokenBucketTracker**: Client-side rate limiting using Token Bucket algorithm.\nHelps prevent hitting server 429s by tracking \"cost\" of requests.\n\n\n## Dependencies\nNo external dependencies\n\n## Exports\n- HealthScoreConfig\n- DEFAULT_HEALTH_SCORE_CONFIG\n- HealthScoreTracker\n- addJitter\n- randomDelay\n- AccountWithMetrics\n- sortByLruWithHealth\n- selectHybridAccount\n- TokenBucketConfig\n- DEFAULT_TOKEN_BUCKET_CONFIG\n- TokenBucketTracker\n- getTokenTracker\n- initTokenTracker\n- getHealthTracker\n- initHealthTracker\n\n## Complexity Metrics\n- Lines of code: 425\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.051Z",
    "updated_at": "2026-01-30T05:26:52.051Z",
    "hash": "8094ba23b7b7c8e7000ab1e9fbc8c35cca494bb8971e94cceacdf90a1623e6b3",
    "dependencies": [],
    "symbols": [
      "HealthScoreConfig",
      "DEFAULT_HEALTH_SCORE_CONFIG",
      "HealthScoreState",
      "HealthScoreTracker",
      "state",
      "now",
      "hoursSinceUpdate",
      "recoveredPoints",
      "now",
      "current",
      "now",
      "state",
      "current",
      "now",
      "state",
      "current",
      "result",
      "addJitter",
      "jitterRange",
      "jitter",
      "randomDelay",
      "AccountWithMetrics",
      "sortByLruWithHealth",
      "lruDiff",
      "selectHybridAccount",
      "candidates",
      "maxTokens",
      "scored",
      "AccountWithTokens",
      "calculateHybridScore",
      "healthComponent",
      "tokenComponent",
      "secondsSinceUsed",
      "freshnessComponent",
      "TokenBucketConfig",
      "DEFAULT_TOKEN_BUCKET_CONFIG",
      "TokenBucketState",
      "TokenBucketTracker",
      "state",
      "now",
      "minutesSinceUpdate",
      "recoveredTokens",
      "current",
      "current",
      "globalTokenTracker",
      "getTokenTracker",
      "initTokenTracker",
      "globalHealthTracker",
      "getHealthTracker",
      "initHealthTracker"
    ],
    "complexity_score": 100
  }
}