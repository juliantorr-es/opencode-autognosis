{
  "id": "request-helpers.ts-api-4b15dc9b",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-google-antigravity-auth/src/plugin/request-helpers.ts",
  "chunk_type": "api",
  "content": "# API Surface: request-helpers.ts\n\n## Public Functions\n\n### getSessionId\n```typescript\nexport function getSessionId(): string\n```\nNo documentation found\n\n**Returns:** string\n\n\n### generateRequestId\n```typescript\nexport function generateRequestId(): string\n```\nNo documentation found\n\n**Returns:** string\n\n\n### applyAntigravitySystemInstruction\n```typescript\nexport function applyAntigravitySystemInstruction(payload: Record<string, unknown>, model: string): void\n```\nNo documentation found\n\n**Parameters:**\n- `payload`: Record<string, unknown> - \n- `model`: string - \n\n**Returns:** void\n\n\n### normalizeThinkingConfig\n```typescript\nexport function normalizeThinkingConfig(config: unknown): ThinkingConfig | undefined\n```\nNormalizes thinkingConfig - passes through values as-is without mapping.\nUser should use thinkingLevel for Gemini 3 and thinkingBudget for Gemini 2.5.\n\n**Parameters:**\n- `config`: unknown - \n\n**Returns:** ThinkingConfig | undefined\n\n\n### parseGeminiApiBody\n```typescript\nexport function parseGeminiApiBody(rawText: string): GeminiApiBody | null\n```\nParses a Gemini API body; handles array-wrapped responses the API sometimes returns.\n\n**Parameters:**\n- `rawText`: string - \n\n**Returns:** GeminiApiBody | null\n\n\n### extractUsageMetadata\n```typescript\nexport function extractUsageMetadata(body: GeminiApiBody): GeminiUsageMetadata | null\n```\nExtracts usageMetadata from a response object, guarding types.\n\n**Parameters:**\n- `body`: GeminiApiBody - \n\n**Returns:** GeminiUsageMetadata | null\n\n\n### extractUsageFromSsePayload\n```typescript\nexport function extractUsageFromSsePayload(payload: string): GeminiUsageMetadata | null\n```\nWalks SSE lines to find a usage-bearing response chunk.\n\n**Parameters:**\n- `payload`: string - \n\n**Returns:** GeminiUsageMetadata | null\n\n\n### rewriteGeminiPreviewAccessError\n```typescript\nexport function rewriteGeminiPreviewAccessError(\n  body: GeminiApiBody,\n  status: number,\n  requestedModel?: string,\n): GeminiApiBody | null\n```\nEnhances 404 errors for Gemini 3 models with a direct preview-access message.\n\n**Parameters:**\n- `body`: GeminiApiBody - \n- `status`: number - \n- `requestedModel`: string - \n\n**Returns:** GeminiApiBody | null\n\n\n### rewriteGeminiRateLimitError\n```typescript\nexport function rewriteGeminiRateLimitError(\n  body: GeminiApiBody,\n): GeminiApiBody | null\n```\nEnhanced error handling for rate limits (429/Resource Exhausted).\nExtracts quota reset time and formats a friendly message.\n\n**Parameters:**\n- `body`: GeminiApiBody - \n\n**Returns:** GeminiApiBody | null\n\n\n### toUrlString\n```typescript\nexport function toUrlString(value: RequestInfo): string\n```\nNo documentation found\n\n**Parameters:**\n- `value`: RequestInfo - \n\n**Returns:** string\n\n\n### recursivelyParseJsonStrings\n```typescript\nexport function recursivelyParseJsonStrings(value: unknown): unknown\n```\nNo documentation found\n\n**Parameters:**\n- `value`: unknown - \n\n**Returns:** unknown\n\n\n### processEscapeSequencesOnly\n```typescript\nexport function processEscapeSequencesOnly(value: unknown): unknown\n```\nProcesses a value by only unescaping control characters (like \\n, \\t).\nIt does NOT attempt to parse JSON objects from strings.\n\n**Parameters:**\n- `value`: unknown - \n\n**Returns:** unknown\n\n\n### normalizeToolCallArgs\n```typescript\nexport function normalizeToolCallArgs(args: unknown, toolName: string): unknown\n```\nNormalizes tool call arguments based on their schema.\n- If schema says string: only unescape control characters, don't parse as JSON.\n- If schema says array/object: attempt to parse string as JSON.\n- If no schema: fallback to processEscapeSequencesOnly.\n\n**Parameters:**\n- `args`: unknown - \n- `toolName`: string - \n\n**Returns:** unknown\n\n\n## Classes\n\n\n## Interfaces\n\n### GeminiApiError\n```typescript\nexport interface GeminiApiError\n```\nNo documentation found\n\n\n### GeminiApiBody\n```typescript\nexport interface GeminiApiBody\n```\nMinimal representation of Gemini API responses we touch.\n\n\n### GeminiUsageMetadata\n```typescript\nexport interface GeminiUsageMetadata\n```\nUsage metadata exposed by Gemini responses. Fields are optional to reflect partial payloads.\n\n\n### ThinkingConfig\n```typescript\nexport interface ThinkingConfig\n```\nThinking configuration accepted by Gemini.\n- Gemini 3 models use thinkingLevel (string: 'low', 'medium', 'high')\n- Gemini 2.5 models use thinkingBudget (number)\n\n\n### ErrorDetail\n```typescript\ninterface ErrorDetail\n```\nNo documentation found\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.224Z",
    "updated_at": "2026-01-30T05:26:52.224Z",
    "hash": "8b854b5b5d779778036602e6fe3e0b0975f84ee074d38c5cc6f1331fc311d154",
    "dependencies": [
      "node:crypto",
      "./tool-schema-cache"
    ],
    "symbols": [
      "SESSION_ID",
      "getSessionId",
      "generateRequestId",
      "ANTIGRAVITY_BASE_SYSTEM_INSTRUCTION",
      "applyAntigravitySystemInstruction",
      "normalizedModel",
      "needsInjection",
      "existing",
      "existingParts",
      "existingRecord",
      "parts",
      "nextParts",
      "GEMINI_PREVIEW_LINK",
      "GeminiApiError",
      "GeminiApiBody",
      "GeminiUsageMetadata",
      "ThinkingConfig",
      "normalizeThinkingConfig",
      "record",
      "budgetRaw",
      "levelRaw",
      "includeRaw",
      "thinkingBudget",
      "thinkingLevel",
      "includeThoughts",
      "normalized",
      "parseGeminiApiBody",
      "parsed",
      "firstObject",
      "extractUsageMetadata",
      "usage",
      "asRecord",
      "toNumber",
      "extractUsageFromSsePayload",
      "lines",
      "line",
      "jsonText",
      "parsed",
      "usage",
      "rewriteGeminiPreviewAccessError",
      "error",
      "trimmedMessage",
      "messagePrefix",
      "enhancedMessage",
      "needsPreviewAccessOverride",
      "errorMessage",
      "ErrorDetail",
      "rewriteGeminiRateLimitError",
      "error",
      "isRateLimit",
      "message",
      "isGeminiThreeModel",
      "toUrlString",
      "candidate",
      "safeJsonParse",
      "recursivelyParseJsonStrings",
      "record",
      "stripped",
      "hasControlCharEscapes",
      "hasIntentionalEscapes",
      "unescaped",
      "isWellFormed",
      "parsed",
      "lastBracket",
      "cleaned",
      "parsed",
      "lastBrace",
      "cleaned",
      "parsed",
      "processEscapeSequencesOnly",
      "hasControlCharEscapes",
      "hasIntentionalEscapes",
      "unescaped",
      "normalizeToolCallArgs",
      "record",
      "result",
      "expectedType",
      "parsed"
    ],
    "complexity_score": 100
  }
}