{
  "id": "worktree.ts-invariant-c22e092a",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-worktree/src/plugin/worktree.ts",
  "chunk_type": "invariant",
  "content": "# Invariants: worktree.ts\n\n## Core Invariants\n\n\n## Constraints\n- **DB_MAX_RETRIES**: 3\n\n/** Delay between retry attempts in milliseconds */\nconst DB_RETRY_DELAY_MS\n\n## Assumptions\n\n\n## State Management\nNo explicit state management patterns detected\n\n## Error Handling\nError handling metrics: 10 try-catch blocks, 2 throw statements\n\n## Performance Considerations\nPerformance patterns: Uses parallel execution (Promise.all), Contains explicit loops\n\n## Security Considerations\nNo obvious security risks detected via static analysis",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.401Z",
    "updated_at": "2026-01-30T05:26:52.401Z",
    "hash": "5cb4e8c4123d29dd8679b8c9ade79b7892cb3bf56839ced4affb48a613eb57e6",
    "dependencies": [
      "bun:sqlite",
      "node:fs/promises",
      "node:os",
      "node:path",
      "@opencode-ai/plugin",
      "@opencode-ai/sdk",
      "./kdco-primitives/types",
      "jsonc-parser",
      "zod",
      "./kdco-primitives/get-project-id",
      "./worktree/state",
      "./worktree/terminal"
    ],
    "symbols": [
      "Logger",
      "DB_MAX_RETRIES",
      "DB_RETRY_DELAY_MS",
      "MAX_SESSION_CHAIN_DEPTH",
      "OkResult",
      "ErrResult",
      "Result",
      "Result",
      "isValidBranchName",
      "i",
      "code",
      "branchNameSchema",
      "worktreeConfigSchema",
      "WorktreeConfig",
      "WorktreeError",
      "pathExists",
      "e",
      "copyIfExists",
      "copyDirIfExists",
      "ForkResult",
      "forkWithContext",
      "rootSessionId",
      "e",
      "forkedSessionResponse",
      "forkedSession",
      "planCopied",
      "delegationsCopied",
      "workspaceBase",
      "delegationsBase",
      "destWorkspaceDir",
      "destDelegationsDir",
      "srcPlan",
      "destPlan",
      "srcDelegations",
      "error",
      "workspaceBase",
      "delegationsBase",
      "destWorkspaceDir",
      "destDelegationsDir",
      "db",
      "projectRoot",
      "cleanupRegistered",
      "registerCleanupHandlers",
      "cleanup",
      "getDb",
      "lastError",
      "attempt",
      "error",
      "initDb",
      "git",
      "proc",
      "error",
      "branchExists",
      "result",
      "createWorktree",
      "worktreePath",
      "exists",
      "result",
      "base",
      "result",
      "removeWorktree",
      "result",
      "isPathSafe",
      "resolved",
      "copyFiles",
      "file",
      "sourcePath",
      "targetPath",
      "sourceFile",
      "targetFileDir",
      "error",
      "isNotFound",
      "symlinkDirs",
      "dir",
      "sourcePath",
      "targetPath",
      "fileStat",
      "targetParentDir",
      "error",
      "runHooks",
      "command",
      "result",
      "stderr",
      "error",
      "loadWorktreeConfig",
      "configPath",
      "file",
      "defaultConfig",
      "content",
      "parsed",
      "error",
      "WorktreePlugin",
      "log",
      "database",
      "branchResult",
      "baseResult",
      "result",
      "worktreePath",
      "worktreeConfig",
      "mainWorktreePath",
      "projectId",
      "currentId",
      "depth",
      "session",
      "terminalResult",
      "session",
      "pendingDelete",
      "config",
      "addResult",
      "commitResult",
      "removeResult"
    ],
    "complexity_score": 100
  }
}