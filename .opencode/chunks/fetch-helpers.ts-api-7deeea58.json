{
  "id": "fetch-helpers.ts-api-7deeea58",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-openai-codex-auth/lib/request/fetch-helpers.ts",
  "chunk_type": "api",
  "content": "# API Surface: fetch-helpers.ts\n\n## Public Functions\n\n### shouldRefreshToken\n```typescript\nexport function shouldRefreshToken(auth: Auth): boolean\n```\nDetermines if the current auth token needs to be refreshed\n\n**Parameters:**\n- `auth`: Auth - \n\n**Returns:** boolean\n\n\n### refreshAndUpdateToken\n```typescript\nexport async function refreshAndUpdateToken(\n\tcurrentAuth: Auth,\n\tclient: OpencodeClient,\n): Promise<Auth>\n```\nRefreshes the OAuth token and updates stored credentials\n\n**Parameters:**\n- `currentAuth`: Auth - \n- `client`: OpencodeClient - \n\n**Returns:** Promise<Auth>\n\n\n### extractRequestUrl\n```typescript\nexport function extractRequestUrl(input: Request | string | URL): string\n```\nExtracts URL string from various request input types\n\n**Parameters:**\n- `input`: Request | string | URL - \n\n**Returns:** string\n\n\n### rewriteUrlForCodex\n```typescript\nexport function rewriteUrlForCodex(url: string): string\n```\nRewrites OpenAI API URLs to Codex backend URLs\n\n**Parameters:**\n- `url`: string - \n\n**Returns:** string\n\n\n### transformRequestForCodex\n```typescript\nexport async function transformRequestForCodex(\n\tinit: RequestInit | undefined,\n\turl: string,\n\tuserConfig: UserConfig,\n\tcodexMode = true,\n): Promise<\n```\nTransforms request body and logs the transformation\nFetches model-specific Codex instructions based on the request model\n\n**Parameters:**\n- `init`: RequestInit | undefined - \n- `url`: string - \n- `userConfig`: UserConfig - \n- `codexMode`: any - \n\n**Returns:** Promise<{ body: RequestBody; updatedInit: RequestInit } | undefined>\n\n\n### createCodexHeaders\n```typescript\nexport function createCodexHeaders(\n    init: RequestInit | undefined,\n    accountId: string,\n    accessToken: string,\n    opts?:\n```\nCreates headers for Codex API requests\n\n**Parameters:**\n- `init`: RequestInit | undefined - \n- `accountId`: string - \n- `accessToken`: string - \n- `opts`: { model?: string; promptCacheKey?: string } - \n\n**Returns:** Headers\n\n\n### handleErrorResponse\n```typescript\nexport async function handleErrorResponse(\n    response: Response,\n): Promise<Response>\n```\nHandles error responses from the Codex API\n\n**Parameters:**\n- `response`: Response - \n\n**Returns:** Promise<Response>\n\n\n### handleSuccessResponse\n```typescript\nexport async function handleSuccessResponse(\n    response: Response,\n    isStreaming: boolean,\n): Promise<Response>\n```\nHandles successful responses from the Codex API\nConverts SSE to JSON for non-streaming requests (generateText)\nPasses through SSE for streaming requests (streamText)\n\n**Parameters:**\n- `response`: Response - \n- `isStreaming`: boolean - \n\n**Returns:** Promise<Response>\n\n\n## Classes\n\n\n## Interfaces\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.295Z",
    "updated_at": "2026-01-30T05:26:52.295Z",
    "hash": "31a8211ec99ad2479f90022d8483cdcd793d363216e298775211ed1156bb9121",
    "dependencies": [
      "@opencode-ai/sdk",
      "@opencode-ai/sdk",
      "../auth/auth.js",
      "../logger.js",
      "../prompts/codex.js",
      "./request-transformer.js",
      "./response-handler.js",
      "../types.js",
      "../constants.js"
    ],
    "symbols": [
      "shouldRefreshToken",
      "refreshAndUpdateToken",
      "refreshToken",
      "refreshResult",
      "extractRequestUrl",
      "rewriteUrlForCodex",
      "transformRequestForCodex",
      "body",
      "originalModel",
      "normalizedModel",
      "modelFamily",
      "codexInstructions",
      "transformedBody",
      "e",
      "createCodexHeaders",
      "headers",
      "cacheKey",
      "handleErrorResponse",
      "mapped",
      "finalResponse",
      "handleSuccessResponse",
      "responseHeaders",
      "mapUsageLimit404",
      "clone",
      "text",
      "code",
      "parsed",
      "haystack",
      "headers"
    ],
    "complexity_score": 100
  }
}