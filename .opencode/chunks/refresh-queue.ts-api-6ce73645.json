{
  "id": "refresh-queue.ts-api-6ce73645",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/refresh-queue.ts",
  "chunk_type": "api",
  "content": "# API Surface: refresh-queue.ts\n\n## Public Functions\n\n### createProactiveRefreshQueue\n```typescript\nexport function createProactiveRefreshQueue(\n  client: PluginClient,\n  providerId: string,\n  config?: Partial<ProactiveRefreshConfig>,\n): ProactiveRefreshQueue\n```\nCreate a proactive refresh queue instance.\n\n**Parameters:**\n- `client`: PluginClient - \n- `providerId`: string - \n- `config`: Partial<ProactiveRefreshConfig> - \n\n**Returns:** ProactiveRefreshQueue\n\n\n## Classes\n\n### ProactiveRefreshQueue\n```typescript\nexport class ProactiveRefreshQueue\n```\nProactive Token Refresh Queue\n\nRuns in the background and proactively refreshes tokens before they expire.\nThis ensures that user requests never block on token refresh.\n\nAll logging is silent by default - uses structured logger that only outputs\nwhen OPENCODE_ANTIGRAVITY_CONSOLE_LOG=1 is set or TUI logging is available.\n\n**Methods:**\n- `setAccountManager`: setAccountManager(manager: AccountManager): void\n- `needsRefresh`: needsRefresh(account: ManagedAccount): boolean\n- `isExpired`: isExpired(account: ManagedAccount): boolean\n- `getAccountsNeedingRefresh`: getAccountsNeedingRefresh(): ManagedAccount[]\n- `runRefreshCheck`: private async runRefreshCheck(): Promise<void>\n- `refreshToken`: private async refreshToken(\n    auth: OAuthAuthDetails,\n    account: ManagedAccount,\n  ): Promise<OAuthAuthDetails | undefined>\n- `start`: start(): void\n- `stop`: stop(): void\n- `getStats`: getStats():\n- `isRunning`: isRunning(): boolean\n\n\n**Properties:**\n- `config`: ProactiveRefreshConfig\n- `client`: PluginClient\n- `providerId`: string\n- `accountManager`: AccountManager | null\n- `state`: RefreshQueueState\n\n\n\n## Interfaces\n\n### ProactiveRefreshConfig\n```typescript\nexport interface ProactiveRefreshConfig\n```\nConfiguration for the proactive refresh queue\n\n\n### RefreshQueueState\n```typescript\ninterface RefreshQueueState\n```\nState for tracking refresh operations\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:51.982Z",
    "updated_at": "2026-01-30T05:26:51.982Z",
    "hash": "c181cb6cffa57decefebc6b9c7451e6192b7d070835236cf562099e864ecf61d",
    "dependencies": [
      "./accounts",
      "./types",
      "./token",
      "./logger"
    ],
    "symbols": [
      "log",
      "ProactiveRefreshConfig",
      "DEFAULT_PROACTIVE_REFRESH_CONFIG",
      "RefreshQueueState",
      "ProactiveRefreshQueue",
      "now",
      "bufferMs",
      "refreshThreshold",
      "accountsToRefresh",
      "account",
      "auth",
      "refreshed",
      "error",
      "minutesUntilExpiry",
      "intervalMs",
      "createProactiveRefreshQueue"
    ],
    "complexity_score": 100
  }
}