{
  "id": "compaction.ts-summary-be36b245",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-supermemory/src/services/compaction.ts",
  "chunk_type": "summary",
  "content": "# Summary: compaction.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (13)\n- **createCompactionPrompt**: No documentation found\n- **getMessageDir**: No documentation found\n- **getOrCreateMessageDir**: No documentation found\n- **findNearestMessageWithFields**: No documentation found\n- **generateMessageId**: No documentation found\n- **generatePartId**: No documentation found\n- **injectHookMessage**: No documentation found\n- **createCompactionHook**: No documentation found\n- **fetchProjectMemoriesForCompaction**: No documentation found\n- **injectCompactionContext**: No documentation found\n- **saveSummaryAsMemory**: No documentation found\n- **checkAndTriggerCompaction**: No documentation found\n- **handleSummaryMessage**: No documentation found\n\n\n\n\n## Dependencies\n- node:fs\n- node:path\n- node:os\n- ./client.js\n- ./logger.js\n- ../config.js\n\n## Exports\n- CompactionOptions\n- CompactionContext\n- createCompactionHook\n\n## Complexity Metrics\n- Lines of code: 541\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.367Z",
    "updated_at": "2026-01-30T05:26:52.367Z",
    "hash": "29711a4811bbb12bbf8819c57d4393cfcb5c9ca4689119c14f8f18fae15680cd",
    "dependencies": [
      "node:fs",
      "node:path",
      "node:os",
      "./client.js",
      "./logger.js",
      "../config.js"
    ],
    "symbols": [
      "MESSAGE_STORAGE",
      "PART_STORAGE",
      "DEFAULT_THRESHOLD",
      "MIN_TOKENS_FOR_COMPACTION",
      "COMPACTION_COOLDOWN_MS",
      "DEFAULT_CONTEXT_LIMIT",
      "CompactionState",
      "TokenInfo",
      "MessageInfo",
      "StoredMessage",
      "SummarizeContext",
      "CompactionOptions",
      "createCompactionPrompt",
      "memoriesSection",
      "getMessageDir",
      "directPath",
      "dir",
      "sessionPath",
      "getOrCreateMessageDir",
      "directPath",
      "dir",
      "sessionPath",
      "findNearestMessageWithFields",
      "files",
      "file",
      "content",
      "msg",
      "generateMessageId",
      "timestamp",
      "random",
      "generatePartId",
      "timestamp",
      "random",
      "injectHookMessage",
      "messageDir",
      "fallback",
      "now",
      "messageID",
      "partID",
      "resolvedAgent",
      "resolvedModel",
      "messageMeta",
      "textPart",
      "partDir",
      "err",
      "CompactionContext",
      "createCompactionHook",
      "state",
      "threshold",
      "getModelLimit",
      "fetchProjectMemoriesForCompaction",
      "result",
      "memories",
      "err",
      "injectCompactionContext",
      "projectMemories",
      "prompt",
      "success",
      "saveSummaryAsMemory",
      "result",
      "err",
      "checkAndTriggerCompaction",
      "lastCompaction",
      "tokens",
      "modelID",
      "providerID",
      "agent",
      "messageDir",
      "storedMessage",
      "configLimit",
      "contextLimit",
      "totalUsed",
      "usageRatio",
      "messageDir",
      "storedMessage",
      "err",
      "handleSummaryMessage",
      "resp",
      "messages",
      "summaryMessage",
      "textParts",
      "summaryContent",
      "err",
      "props",
      "sessionInfo",
      "info",
      "sessionID",
      "sessionID",
      "resp",
      "messages",
      "assistants",
      "lastAssistant",
      "messageDir",
      "storedMessage"
    ],
    "complexity_score": 100
  }
}