{
  "id": "gemini.ts-api-dd4f6e2b",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-google-antigravity-auth/src/plugin/transform/gemini.ts",
  "chunk_type": "api",
  "content": "# API Surface: gemini.ts\n\n## Public Functions\n\n### transformGeminiRequest\n```typescript\nexport function transformGeminiRequest(\n  context: TransformContext,\n  parsedBody: RequestPayload,\n): TransformResult\n```\nTransforms a request payload for native Gemini models.\n\nHandles common transformations:\n- Removes `safetySettings` (Antigravity manages these)\n- Sets `toolConfig.functionCallingConfig.mode` to \"VALIDATED\"\n- Normalizes `thinkingConfig` for Gemini 2.5/3 models\n- Extracts and normalizes `cachedContent` from various locations\n- Wraps payload with Antigravity metadata (project, userAgent, requestId, sessionId)\n\n**Parameters:**\n- `context`: TransformContext - \n- `parsedBody`: RequestPayload - \n\n**Returns:** TransformResult\n\n\n## Classes\n\n\n## Interfaces\n\n\n## Types\n\n### ScrubResult\n```typescript\ntype ScrubResult\n```\nNo documentation found\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.257Z",
    "updated_at": "2026-01-30T05:26:52.257Z",
    "hash": "00141d067848f46a2d5ca408dac28840e0e51575b911c1b70c5b92ae6909a139",
    "dependencies": [
      "../cache",
      "../logger",
      "../request-helpers",
      "../tool-schema-cache",
      "./types"
    ],
    "symbols": [
      "log",
      "THOUGHT_SIGNATURE_BYPASS",
      "GEMINI_TOOL_SCHEMA_SYSTEM_INSTRUCTION",
      "hasFunctionTools",
      "tools",
      "extractSystemInstructionText",
      "parts",
      "getToolCallingMode",
      "toolConfig",
      "functionCallingConfig",
      "mode",
      "getFunctionToolNames",
      "tools",
      "names",
      "tool",
      "funcDecls",
      "funcDecl",
      "name",
      "hasInjectedToolSchemaInstruction",
      "existingText",
      "ScrubResult",
      "scrubToolTranscriptArtifacts",
      "lines",
      "output",
      "removedLines",
      "removedBlocks",
      "inFence",
      "fenceStart",
      "fenceLines",
      "isMarkerLine",
      "line",
      "isFence",
      "hadMarker",
      "cleanedFenceLines",
      "fenceLine",
      "hasNonWhitespace",
      "cleaned",
      "scrubConversationArtifactsFromModelHistory",
      "contents",
      "scrubbedParts",
      "removedLines",
      "removedBlocks",
      "content",
      "parts",
      "part",
      "scrubbed",
      "injectSystemInstructionIfNeeded",
      "existingText",
      "existing",
      "suffix",
      "asRecord",
      "parts",
      "normalizeSchemaType",
      "nonNull",
      "first",
      "summarizeSchema",
      "record",
      "normalizedType",
      "enumValues",
      "items",
      "itemSummary",
      "props",
      "required",
      "keys",
      "requiredKeys",
      "optionalKeys",
      "orderedKeys",
      "maxPropsToShow",
      "shownKeys",
      "inner",
      "propSchema",
      "propType",
      "requiredSuffix",
      "extraCount",
      "extra",
      "preview",
      "suffix",
      "buildStrictParamsSummary",
      "schemaType",
      "properties",
      "required",
      "keys",
      "requiredKeys",
      "optionalKeys",
      "orderedKeys",
      "parts",
      "propSchema",
      "typeSummary",
      "requiredSuffix",
      "summary",
      "maxLen",
      "augmentToolDescriptionsWithStrictParams",
      "tools",
      "augmented",
      "toolNames",
      "tool",
      "funcDecls",
      "funcDecl",
      "schema",
      "currentDescription",
      "summary",
      "nextDescription",
      "sanitizeToolNameForGemini",
      "sanitizeToolNames",
      "tools",
      "tool",
      "funcDecls",
      "func",
      "originalName",
      "transformGeminiRequest",
      "requestPayload",
      "toolConfig",
      "rawGenerationConfig",
      "normalizedThinking",
      "cachedContentFromExtra",
      "cachedContent",
      "contents",
      "contentIndex",
      "content",
      "parts",
      "filteredParts",
      "thinkingBlocksRemoved",
      "removedThoughtSignatures",
      "addedFunctionCallThoughtSignatures",
      "currentThoughtSignature",
      "partIndex",
      "part",
      "thoughtText",
      "cachedSig",
      "functionCall",
      "callName",
      "existingSig",
      "source",
      "nextSig",
      "wrappedBody",
      "toolCount",
      "toolCallingMode",
      "systemInstructionHasMarker",
      "functionToolNames",
      "contentsCount",
      "body",
      "countTools",
      "tools",
      "count",
      "tool",
      "funcDecls"
    ],
    "complexity_score": 100
  }
}