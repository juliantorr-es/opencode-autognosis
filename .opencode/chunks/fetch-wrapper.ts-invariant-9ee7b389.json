{
  "id": "fetch-wrapper.ts-invariant-9ee7b389",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-google-antigravity-auth/src/plugin/fetch-wrapper.ts",
  "chunk_type": "invariant",
  "content": "# Invariants: fetch-wrapper.ts\n\n## Core Invariants\n\n\n## Constraints\n- **RATE_LIMIT_BACKOFF_BASE_MS**: 1000\n- **RATE_LIMIT_BACKOFF_MAX_MS**: 60 * 60 * 1000\n- **RATE_LIMIT_SERVER_RETRY_MAX_MS**: 24 * 60 * 60 * 1000\n\n## Assumptions\n\n\n## State Management\nNo explicit state management patterns detected\n\n## Error Handling\nError handling metrics: 15 try-catch blocks, 0 throw statements\n\n## Performance Considerations\nPerformance patterns: Contains explicit loops\n\n## Security Considerations\nNo obvious security risks detected via static analysis",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.210Z",
    "updated_at": "2026-01-30T05:26:52.210Z",
    "hash": "a3022010921c85375e5f166c59873e8d718df7afed07284ad10f4ad0a28820e8",
    "dependencies": [
      "./types",
      "../constants",
      "./auth",
      "./accounts",
      "./storage",
      "./token",
      "./project",
      "./request",
      "./request-helpers",
      "./debug",
      "./logger"
    ],
    "symbols": [
      "log",
      "RATE_LIMIT_BACKOFF_BASE_MS",
      "RATE_LIMIT_BACKOFF_MAX_MS",
      "RATE_LIMIT_SERVER_RETRY_MAX_MS",
      "RateLimitDelay",
      "computeExponentialBackoffMs",
      "safeAttempt",
      "multiplier",
      "toUrlStr",
      "extractModelFromUrl",
      "match",
      "getModelFamilyFromUrl",
      "model",
      "sleep",
      "timeout",
      "onAbort",
      "cleanup",
      "sleepWithBackoff",
      "stepsMs",
      "remainingMs",
      "stepIndex",
      "stepMs",
      "waitMs",
      "overrideEndpointForRequest",
      "replaceBase",
      "newUrl",
      "parseRetryAfterMs",
      "retryAfterMsHeader",
      "retryAfterSecondsHeader",
      "parsed",
      "parsed",
      "parseDurationLikeToMs",
      "trimmed",
      "matches",
      "totalMs",
      "match",
      "value",
      "unit",
      "parsed",
      "formatWaitTimeMs",
      "totalSeconds",
      "hours",
      "minutes",
      "seconds",
      "RateLimitBodyInfo",
      "extractRateLimitBodyInfo",
      "error",
      "message",
      "details",
      "detail",
      "type",
      "retryDelay",
      "retryDelayMs",
      "detail",
      "metadata",
      "quotaResetDelay",
      "quotaResetDelayMs",
      "afterMatch",
      "rawDuration",
      "parsed",
      "parseRateLimitInfoFromBodyText",
      "direct",
      "lines",
      "line",
      "jsonText",
      "parsed",
      "info",
      "extractRetryAfterFromBodyMs",
      "text",
      "AttemptInfo",
      "EndpointLoopResult",
      "handleRateLimit",
      "retryAfterHeaderMs",
      "bodyInfo",
      "retryAfterBodyMs",
      "serverRetryAfterMs",
      "retryAfterMs",
      "waitTimeSec",
      "retrySource",
      "error",
      "switchThresholdMs",
      "error",
      "handleServerError",
      "retryAfterMs",
      "error",
      "tryEndpointFallbacks",
      "lastError",
      "lastResponse",
      "lastAttemptInfo",
      "normalizedInput",
      "i",
      "currentEndpoint",
      "finalUrl",
      "originalUrl",
      "resolvedUrl",
      "debugContext",
      "response",
      "shouldRetryEndpoint",
      "error",
      "createAntigravityFetch",
      "rateLimitStateByAccount",
      "getRateLimitDelay",
      "now",
      "previous",
      "attempt",
      "backoffMs",
      "delayMs",
      "resetRateLimitState",
      "normalizedInput",
      "latestAuth",
      "urlString",
      "family",
      "storedAccounts",
      "accountManager",
      "accountCount",
      "resolveProjectContext",
      "abortSignal",
      "previousAccount",
      "account",
      "waitTimeMs",
      "waitTimeSec",
      "waitTimeHuman",
      "isSwitch",
      "wasRateLimited",
      "switchReason",
      "error",
      "authRecord",
      "refreshed",
      "parts",
      "error",
      "accessToken",
      "projectContext",
      "result",
      "waitMs",
      "saveError",
      "debugContext",
      "debugContext"
    ],
    "complexity_score": 100
  }
}