{
  "id": "request.ts-invariant-139997c8",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/request.ts",
  "chunk_type": "invariant",
  "content": "# Invariants: request.ts\n\n## Core Invariants\n\n\n## Constraints\n- **PLUGIN_SESSION_ID**: `-${crypto.randomUUID()}`\n- **MIN_SIGNATURE_LENGTH**: 50\n- **STREAM_ACTION**: \"streamGenerateContent\"\n\n## Assumptions\n\n\n## State Management\nNo explicit state management patterns detected\n\n## Error Handling\nError handling metrics: 5 try-catch blocks, 0 throw statements\n\n## Performance Considerations\nPerformance patterns: Contains explicit loops\n\n## Security Considerations\nNo obvious security risks detected via static analysis",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.040Z",
    "updated_at": "2026-01-30T05:26:52.040Z",
    "hash": "434068bd2d0f2531c13208b9c15e3022b1212639afa0883cfd51cbc20950d063",
    "dependencies": [
      "node:crypto",
      "../constants",
      "./cache",
      "./core/streaming",
      "./stores/signature-store",
      "./debug",
      "./logger",
      "./request-helpers",
      "../constants",
      "./thinking-recovery",
      "./transform/cross-model-sanitizer",
      "./transform",
      "./transform",
      "./recovery"
    ],
    "symbols": [
      "log",
      "PLUGIN_SESSION_ID",
      "sessionDisplayedThinkingHashes",
      "MIN_SIGNATURE_LENGTH",
      "buildSignatureSessionKey",
      "modelKey",
      "projectPart",
      "conversationPart",
      "shouldCacheThinkingSignatures",
      "lower",
      "hashConversationSeed",
      "extractTextFromContent",
      "block",
      "anyBlock",
      "extractConversationSeedFromMessages",
      "system",
      "users",
      "firstUser",
      "lastUser",
      "systemText",
      "userText",
      "fallbackUserText",
      "extractConversationSeedFromContents",
      "users",
      "firstUser",
      "lastUser",
      "primaryUser",
      "resolveConversationKey",
      "anyPayload",
      "candidates",
      "candidate",
      "systemSeed",
      "messageSeed",
      "seed",
      "resolveConversationKeyFromRequests",
      "req",
      "key",
      "resolveProjectKey",
      "formatDebugLinesForThinking",
      "cleaned",
      "injectDebugThinking",
      "resp",
      "candidates",
      "first",
      "parts",
      "content",
      "stripInjectedDebugFromParts",
      "record",
      "text",
      "stripInjectedDebugFromRequestPayload",
      "anyPayload",
      "isGeminiToolUsePart",
      "isGeminiThinkingPart",
      "ensureThoughtSignature",
      "text",
      "cached",
      "cached",
      "hasSignedThinkingPart",
      "ensureThinkingBeforeToolUseInContents",
      "role",
      "parts",
      "hasToolUse",
      "thinkingParts",
      "otherParts",
      "hasSignedThinking",
      "lastThinking",
      "injected",
      "ensureMessageThinkingSignature",
      "text",
      "cached",
      "hasToolUseInContents",
      "hasSignedThinkingInContents",
      "hasToolUseInMessages",
      "hasSignedThinkingInMessages",
      "ensureThinkingBeforeToolUseInMessages",
      "blocks",
      "hasToolUse",
      "thinkingBlocks",
      "otherBlocks",
      "hasSignedThinking",
      "lastThinking",
      "existingThinking",
      "thinkingText",
      "sentinelBlock",
      "injected",
      "getPluginSessionId",
      "generateSyntheticProjectId",
      "adjectives",
      "nouns",
      "adj",
      "noun",
      "randomPart",
      "STREAM_ACTION",
      "isGenerativeLanguageRequest",
      "PrepareRequestOptions",
      "prepareAntigravityRequest",
      "baseInit",
      "headers",
      "resolvedProjectId",
      "toolDebugMissing",
      "toolDebugSummaries",
      "toolDebugPayload",
      "sessionId",
      "needsSignedThinkingWarmup",
      "thinkingRecoveryMessage",
      "match",
      "requestedModel",
      "resolved",
      "effectiveModel",
      "streaming",
      "defaultEndpoint",
      "baseEndpoint",
      "transformedUrl",
      "isClaude",
      "isClaudeThinking",
      "tierThinkingBudget",
      "tierThinkingLevel",
      "signatureSessionKey",
      "body",
      "parsedBody",
      "isWrapped",
      "wrappedBody",
      "requestRoot",
      "requestObjects",
      "nested",
      "conversationKey",
      "modelForCacheKey",
      "req",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "requestPayload",
      "rawGenerationConfig",
      "extraBody",
      "variantConfig",
      "isGemini3",
      "toolConfig",
      "isImageModel",
      "userThinkingConfig",
      "hasAssistantHistory",
      "isClaudeSonnetNonThinking",
      "effectiveUserThinkingConfig",
      "imageConfig",
      "generationConfig",
      "finalThinkingConfig",
      "normalizedThinking",
      "thinkingBudget",
      "thinkingConfig",
      "currentMax",
      "generationConfig",
      "hint",
      "existing",
      "sys",
      "partsValue",
      "parts",
      "appended",
      "i",
      "part",
      "partRecord",
      "text",
      "cachedContentFromExtra",
      "cachedContent",
      "functionDeclarations",
      "passthroughTools",
      "normalizeSchema",
      "createPlaceholderSchema",
      "cleaned",
      "hasProperties",
      "pushDeclaration",
      "schema",
      "name",
      "description",
      "finalTools",
      "effectiveSearchConfig",
      "geminiResult",
      "enableToolHardening",
      "conversationKey",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "toolCallCounter",
      "pendingCallIdsByName",
      "newParts",
      "call",
      "nameKey",
      "queue",
      "newParts",
      "resp",
      "queue",
      "conversationState",
      "effectiveProjectId",
      "existingSystemInstruction",
      "sys",
      "firstPart",
      "wrappedBody",
      "error",
      "existing",
      "interleavedHeader",
      "selectedHeaders",
      "buildThinkingWarmupBody",
      "parsed",
      "warmupPrompt",
      "updateRequest",
      "generationConfig",
      "nested",
      "transformAntigravityResponse",
      "contentType",
      "isJsonResponse",
      "isEventStreamResponse",
      "debugText",
      "cacheSignatures",
      "headers",
      "streamingTransformer",
      "headers",
      "text",
      "errorBody",
      "debugInfo",
      "injectedDebug",
      "errorType",
      "recoveryError",
      "errorMessage",
      "retryInfo",
      "match",
      "retrySeconds",
      "retryAfterSec",
      "retryAfterMs",
      "init",
      "usageFromSse",
      "parsed",
      "patched",
      "effectiveBody",
      "usage",
      "responseBody",
      "transformed",
      "error",
      "__testExports"
    ],
    "complexity_score": 100
  }
}