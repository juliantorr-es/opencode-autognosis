{
  "id": "model-resolver.ts-summary-892c3fb6",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/transform/model-resolver.ts",
  "chunk_type": "summary",
  "content": "# Summary: model-resolver.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nDocumented purpose found in JSDoc\n\n## Key Components\n\n### Functions (9)\n- **supportsThinkingTiers**: Models that support thinking tier suffixes.\nOnly these models should have -low/-medium/-high stripped as thinking tiers.\nGPT models like gpt-oss-120b-medium should NOT have -medium stripped.\n- **extractThinkingTierFromModel**: Extracts thinking tier from model name suffix.\nOnly extracts tier for models that support thinking tiers.\n- **getBudgetFamily**: Determines the budget family for a model.\n- **isThinkingCapableModel**: Checks if a model is a thinking-capable model.\n- **resolveModelWithTier**: Resolves a model name with optional tier suffix and quota prefix to its actual API model name\nand corresponding thinking configuration.\n\nQuota routing:\n- \"antigravity-\" prefix → Antigravity quota\n- Claude/GPT models → Antigravity quota (auto, these only exist on Antigravity)\n- Legacy Gemini 3 names (gemini-3-pro-low, gemini-3-flash, etc.) → Antigravity quota (backward compat)\n- Other models → Gemini CLI quota (default)\n\nExamples:\n- \"gemini-2.5-flash\" → { quotaPreference: \"gemini-cli\" }\n- \"gemini-3-pro-preview\" → { quotaPreference: \"gemini-cli\" } (Gemini CLI uses -preview)\n- \"gemini-3-pro-low\" → { quotaPreference: \"antigravity\" } (legacy name, backward compat)\n- \"antigravity-gemini-3-pro-high\" → { quotaPreference: \"antigravity\" } (explicit prefix)\n- \"claude-sonnet-4-5-thinking-medium\" → { quotaPreference: \"antigravity\" } (Claude only on Antigravity)\n- **getModelFamily**: Gets the model family for routing decisions.\n- **budgetToGemini3Level**: Maps a thinking budget to Gemini 3 thinking level.\n≤8192 → low, ≤16384 → medium, >16384 → high\n- **resolveModelForHeaderStyle**: Resolves model name for a specific headerStyle (quota fallback support).\nTransforms model names when switching between gemini-cli and antigravity quotas.\n\nIssue #103: When quota fallback occurs, model names need to be transformed:\n- gemini-3-flash-preview (gemini-cli) → gemini-3-flash (antigravity)\n- gemini-3-pro-preview (gemini-cli) → gemini-3-pro-low (antigravity)\n- gemini-3-flash (antigravity) → gemini-3-flash-preview (gemini-cli)\n- **resolveModelWithVariant**: Resolves model with variant config from providerOptions.\nVariant config takes priority over tier suffix in model name.\n\n\n\n\n## Dependencies\n- ./types\n\n## Exports\n- THINKING_TIER_BUDGETS\n- GEMINI_3_THINKING_LEVELS\n- MODEL_ALIASES\n- MODEL_FALLBACKS\n- resolveModelWithTier\n- getModelFamily\n- VariantConfig\n- resolveModelForHeaderStyle\n- resolveModelWithVariant\n\n## Complexity Metrics\n- Lines of code: 423\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.110Z",
    "updated_at": "2026-01-30T05:26:52.110Z",
    "hash": "94b7fbc11d173d09adfbe0a6616f72da1b036bb888c0e470c7b574bceca4b451",
    "dependencies": [
      "./types"
    ],
    "symbols": [
      "THINKING_TIER_BUDGETS",
      "GEMINI_3_THINKING_LEVELS",
      "MODEL_ALIASES",
      "MODEL_FALLBACKS",
      "TIER_REGEX",
      "QUOTA_PREFIX_REGEX",
      "ANTIGRAVITY_ONLY_MODELS",
      "IMAGE_GENERATION_MODELS",
      "LEGACY_ANTIGRAVITY_GEMINI3",
      "supportsThinkingTiers",
      "lower",
      "extractThinkingTierFromModel",
      "tierMatch",
      "getBudgetFamily",
      "isThinkingCapableModel",
      "lower",
      "resolveModelWithTier",
      "isAntigravity",
      "modelWithoutQuota",
      "tier",
      "baseName",
      "isAntigravityOnly",
      "isLegacyAntigravity",
      "isImageModel",
      "quotaPreference",
      "explicitQuota",
      "isGemini3",
      "skipAlias",
      "isGemini3Pro",
      "isGemini3Flash",
      "antigravityModel",
      "actualModel",
      "resolvedModel",
      "isThinking",
      "isEffectiveGemini3",
      "isClaudeThinking",
      "budgetFamily",
      "budgets",
      "thinkingBudget",
      "getModelFamily",
      "lower",
      "VariantConfig",
      "budgetToGemini3Level",
      "resolveModelForHeaderStyle",
      "lower",
      "isGemini3",
      "transformedModel",
      "isGemini3Pro",
      "hasTierSuffix",
      "prefixedModel",
      "transformedModel",
      "resolveModelWithVariant",
      "base",
      "budget",
      "isGemini3",
      "level",
      "isAntigravityGemini3Pro",
      "actualModel",
      "baseModel"
    ],
    "complexity_score": 100
  }
}