{
  "id": "model-resolver.ts-api-892c3fb6",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/transform/model-resolver.ts",
  "chunk_type": "api",
  "content": "# API Surface: model-resolver.ts\n\n## Public Functions\n\n### resolveModelWithTier\n```typescript\nexport function resolveModelWithTier(requestedModel: string): ResolvedModel\n```\nResolves a model name with optional tier suffix and quota prefix to its actual API model name\nand corresponding thinking configuration.\n\nQuota routing:\n- \"antigravity-\" prefix → Antigravity quota\n- Claude/GPT models → Antigravity quota (auto, these only exist on Antigravity)\n- Legacy Gemini 3 names (gemini-3-pro-low, gemini-3-flash, etc.) → Antigravity quota (backward compat)\n- Other models → Gemini CLI quota (default)\n\nExamples:\n- \"gemini-2.5-flash\" → { quotaPreference: \"gemini-cli\" }\n- \"gemini-3-pro-preview\" → { quotaPreference: \"gemini-cli\" } (Gemini CLI uses -preview)\n- \"gemini-3-pro-low\" → { quotaPreference: \"antigravity\" } (legacy name, backward compat)\n- \"antigravity-gemini-3-pro-high\" → { quotaPreference: \"antigravity\" } (explicit prefix)\n- \"claude-sonnet-4-5-thinking-medium\" → { quotaPreference: \"antigravity\" } (Claude only on Antigravity)\n\n**Parameters:**\n- `requestedModel`: string - \n\n**Returns:** ResolvedModel\n\n\n### getModelFamily\n```typescript\nexport function getModelFamily(model: string): \"claude\" | \"gemini-flash\" | \"gemini-pro\"\n```\nGets the model family for routing decisions.\n\n**Parameters:**\n- `model`: string - \n\n**Returns:** \"claude\" | \"gemini-flash\" | \"gemini-pro\"\n\n\n### resolveModelForHeaderStyle\n```typescript\nexport function resolveModelForHeaderStyle(\n  requestedModel: string,\n  headerStyle: \"antigravity\" | \"gemini-cli\"\n): ResolvedModel\n```\nResolves model name for a specific headerStyle (quota fallback support).\nTransforms model names when switching between gemini-cli and antigravity quotas.\n\nIssue #103: When quota fallback occurs, model names need to be transformed:\n- gemini-3-flash-preview (gemini-cli) → gemini-3-flash (antigravity)\n- gemini-3-pro-preview (gemini-cli) → gemini-3-pro-low (antigravity)\n- gemini-3-flash (antigravity) → gemini-3-flash-preview (gemini-cli)\n\n**Parameters:**\n- `requestedModel`: string - \n- `headerStyle`: \"antigravity\" | \"gemini-cli\" - \n\n**Returns:** ResolvedModel\n\n\n### resolveModelWithVariant\n```typescript\nexport function resolveModelWithVariant(\n  requestedModel: string,\n  variantConfig?: VariantConfig\n): ResolvedModel\n```\nResolves model with variant config from providerOptions.\nVariant config takes priority over tier suffix in model name.\n\n**Parameters:**\n- `requestedModel`: string - \n- `variantConfig`: VariantConfig - \n\n**Returns:** ResolvedModel\n\n\n## Classes\n\n\n## Interfaces\n\n### VariantConfig\n```typescript\nexport interface VariantConfig\n```\nVariant config from OpenCode's providerOptions.\n\n\n## Types\n",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.111Z",
    "updated_at": "2026-01-30T05:26:52.111Z",
    "hash": "373c457418649f8b5890e936e129f00aeaea66a5a0ca7331913d6a887401b986",
    "dependencies": [
      "./types"
    ],
    "symbols": [
      "THINKING_TIER_BUDGETS",
      "GEMINI_3_THINKING_LEVELS",
      "MODEL_ALIASES",
      "MODEL_FALLBACKS",
      "TIER_REGEX",
      "QUOTA_PREFIX_REGEX",
      "ANTIGRAVITY_ONLY_MODELS",
      "IMAGE_GENERATION_MODELS",
      "LEGACY_ANTIGRAVITY_GEMINI3",
      "supportsThinkingTiers",
      "lower",
      "extractThinkingTierFromModel",
      "tierMatch",
      "getBudgetFamily",
      "isThinkingCapableModel",
      "lower",
      "resolveModelWithTier",
      "isAntigravity",
      "modelWithoutQuota",
      "tier",
      "baseName",
      "isAntigravityOnly",
      "isLegacyAntigravity",
      "isImageModel",
      "quotaPreference",
      "explicitQuota",
      "isGemini3",
      "skipAlias",
      "isGemini3Pro",
      "isGemini3Flash",
      "antigravityModel",
      "actualModel",
      "resolvedModel",
      "isThinking",
      "isEffectiveGemini3",
      "isClaudeThinking",
      "budgetFamily",
      "budgets",
      "thinkingBudget",
      "getModelFamily",
      "lower",
      "VariantConfig",
      "budgetToGemini3Level",
      "resolveModelForHeaderStyle",
      "lower",
      "isGemini3",
      "transformedModel",
      "isGemini3Pro",
      "hasTierSuffix",
      "prefixedModel",
      "transformedModel",
      "resolveModelWithVariant",
      "base",
      "budget",
      "isGemini3",
      "level",
      "isAntigravityGemini3Pro",
      "actualModel",
      "baseModel"
    ],
    "complexity_score": 100
  }
}