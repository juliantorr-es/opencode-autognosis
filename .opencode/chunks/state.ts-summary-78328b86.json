{
  "id": "state.ts-summary-78328b86",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-worktree/src/plugin/worktree/state.ts",
  "chunk_type": "summary",
  "content": "# Summary: state.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (14)\n- **getWorktreePath**: Get the worktree path for a given project and branch.\n- **getDbDirectory**: Get the database directory path.\nLocation: ~/.local/share/opencode/plugins/worktree/\n- **getDbPath**: Get the full database file path for a project.\n- **initStateDb**: Initialize the SQLite database for worktree state.\nCreates the database file and schema if they don't exist.\n- **addSession**: Add a new session to the database.\nUses atomic INSERT OR REPLACE for idempotency.\n- **getSession**: Get a session by ID.\n- **removeSession**: Remove a session by branch name.\nDeletes all sessions matching the branch.\n- **getAllSessions**: Get all active sessions.\n- **setPendingSpawn**: Set a pending spawn operation. Uses singleton pattern (last-write-wins).\n\nIf a pending spawn already exists, it will be REPLACED and a warning logged.\nThis is intentional: only the most recent spawn request should be processed.\n- **getPendingSpawn**: Get the pending spawn operation if one exists.\n- **clearPendingSpawn**: Clear any pending spawn operation.\nRemoves the row if it's a spawn type, leaves deletes untouched.\n- **setPendingDelete**: Set a pending delete operation. Uses singleton pattern (last-write-wins).\n\nIf a pending delete already exists, it will be REPLACED and a warning logged.\nThis is intentional: only the most recent delete request should be processed.\n- **getPendingDelete**: Get the pending delete operation if one exists.\n- **clearPendingDelete**: Clear any pending delete operation.\nRemoves the row if it's a delete type, leaves spawns untouched.\n\n\n\n\n## Dependencies\n- bun:sqlite\n- node:fs\n- node:os\n- node:path\n- zod\n- ../kdco-primitives\n- ../kdco-primitives\n\n## Exports\n- Session\n- PendingSpawn\n- PendingDelete\n- getWorktreePath\n- initStateDb\n- addSession\n- getSession\n- removeSession\n- getAllSessions\n- setPendingSpawn\n- getPendingSpawn\n- clearPendingSpawn\n- setPendingDelete\n- getPendingDelete\n- clearPendingDelete\n\n## Complexity Metrics\n- Lines of code: 413\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.385Z",
    "updated_at": "2026-01-30T05:26:52.385Z",
    "hash": "89f32518d2092933ababddb0334ef902197a4e72f88d59bb708f1da3d21b42bb",
    "dependencies": [
      "bun:sqlite",
      "node:fs",
      "node:os",
      "node:path",
      "zod",
      "../kdco-primitives",
      "../kdco-primitives"
    ],
    "symbols": [
      "Session",
      "PendingSpawn",
      "PendingDelete",
      "sessionSchema",
      "pendingSpawnSchema",
      "pendingDeleteSchema",
      "getWorktreePath",
      "projectId",
      "getDbDirectory",
      "home",
      "getDbPath",
      "projectId",
      "initStateDb",
      "dbPath",
      "dbDir",
      "db",
      "addSession",
      "parsed",
      "stmt",
      "getSession",
      "stmt",
      "row",
      "removeSession",
      "stmt",
      "getAllSessions",
      "stmt",
      "rows",
      "setPendingSpawn",
      "parsed",
      "existingSpawn",
      "existingDelete",
      "stmt",
      "getPendingSpawn",
      "stmt",
      "row",
      "clearPendingSpawn",
      "stmt",
      "setPendingDelete",
      "parsed",
      "existingDelete",
      "existingSpawn",
      "stmt",
      "getPendingDelete",
      "stmt",
      "row",
      "clearPendingDelete",
      "stmt"
    ],
    "complexity_score": 100
  }
}