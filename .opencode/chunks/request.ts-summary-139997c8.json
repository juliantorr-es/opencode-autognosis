{
  "id": "request.ts-summary-139997c8",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin/request.ts",
  "chunk_type": "summary",
  "content": "# Summary: request.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (30)\n- **buildSignatureSessionKey**: No documentation found\n- **shouldCacheThinkingSignatures**: No documentation found\n- **hashConversationSeed**: No documentation found\n- **extractTextFromContent**: No documentation found\n- **extractConversationSeedFromMessages**: No documentation found\n- **extractConversationSeedFromContents**: No documentation found\n- **resolveConversationKey**: No documentation found\n- **resolveConversationKeyFromRequests**: No documentation found\n- **resolveProjectKey**: No documentation found\n- **formatDebugLinesForThinking**: No documentation found\n- **injectDebugThinking**: No documentation found\n- **stripInjectedDebugFromParts**: No documentation found\n- **stripInjectedDebugFromRequestPayload**: No documentation found\n- **isGeminiToolUsePart**: No documentation found\n- **isGeminiThinkingPart**: No documentation found\n- **ensureThoughtSignature**: No documentation found\n- **hasSignedThinkingPart**: No documentation found\n- **ensureThinkingBeforeToolUseInContents**: No documentation found\n- **ensureMessageThinkingSignature**: No documentation found\n- **hasToolUseInContents**: No documentation found\n- **hasSignedThinkingInContents**: No documentation found\n- **hasToolUseInMessages**: No documentation found\n- **hasSignedThinkingInMessages**: No documentation found\n- **ensureThinkingBeforeToolUseInMessages**: No documentation found\n- **getPluginSessionId**: Gets the stable session ID for this plugin instance.\n- **generateSyntheticProjectId**: No documentation found\n- **isGenerativeLanguageRequest**: Detects requests headed to the Google Generative Language API so we can intercept them.\n- **prepareAntigravityRequest**: No documentation found\n- **buildThinkingWarmupBody**: No documentation found\n- **transformAntigravityResponse**: Normalizes Antigravity responses: applies retry headers, extracts cache usage into headers,\nrewrites preview errors, flattens streaming payloads, and logs debug metadata.\n\nFor streaming SSE responses, uses TransformStream for true real-time incremental streaming.\nThinking/reasoning tokens are transformed and forwarded immediately as they arrive.\n\n\n\n\n## Dependencies\n- node:crypto\n- ../constants\n- ./cache\n- ./core/streaming\n- ./stores/signature-store\n- ./debug\n- ./logger\n- ./request-helpers\n- ../constants\n- ./thinking-recovery\n- ./transform/cross-model-sanitizer\n- ./transform\n- ./transform\n- ./recovery\n\n## Exports\n- getPluginSessionId\n- isGenerativeLanguageRequest\n- PrepareRequestOptions\n- prepareAntigravityRequest\n- buildThinkingWarmupBody\n- transformAntigravityResponse\n- __testExports\n\n## Complexity Metrics\n- Lines of code: 1665\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.034Z",
    "updated_at": "2026-01-30T05:26:52.034Z",
    "hash": "166ffe6d4b6bfc3ae3131af1b62c337e172ff7234b891a7a2ca77eddc8ba4302",
    "dependencies": [
      "node:crypto",
      "../constants",
      "./cache",
      "./core/streaming",
      "./stores/signature-store",
      "./debug",
      "./logger",
      "./request-helpers",
      "../constants",
      "./thinking-recovery",
      "./transform/cross-model-sanitizer",
      "./transform",
      "./transform",
      "./recovery"
    ],
    "symbols": [
      "log",
      "PLUGIN_SESSION_ID",
      "sessionDisplayedThinkingHashes",
      "MIN_SIGNATURE_LENGTH",
      "buildSignatureSessionKey",
      "modelKey",
      "projectPart",
      "conversationPart",
      "shouldCacheThinkingSignatures",
      "lower",
      "hashConversationSeed",
      "extractTextFromContent",
      "block",
      "anyBlock",
      "extractConversationSeedFromMessages",
      "system",
      "users",
      "firstUser",
      "lastUser",
      "systemText",
      "userText",
      "fallbackUserText",
      "extractConversationSeedFromContents",
      "users",
      "firstUser",
      "lastUser",
      "primaryUser",
      "resolveConversationKey",
      "anyPayload",
      "candidates",
      "candidate",
      "systemSeed",
      "messageSeed",
      "seed",
      "resolveConversationKeyFromRequests",
      "req",
      "key",
      "resolveProjectKey",
      "formatDebugLinesForThinking",
      "cleaned",
      "injectDebugThinking",
      "resp",
      "candidates",
      "first",
      "parts",
      "content",
      "stripInjectedDebugFromParts",
      "record",
      "text",
      "stripInjectedDebugFromRequestPayload",
      "anyPayload",
      "isGeminiToolUsePart",
      "isGeminiThinkingPart",
      "ensureThoughtSignature",
      "text",
      "cached",
      "cached",
      "hasSignedThinkingPart",
      "ensureThinkingBeforeToolUseInContents",
      "role",
      "parts",
      "hasToolUse",
      "thinkingParts",
      "otherParts",
      "hasSignedThinking",
      "lastThinking",
      "injected",
      "ensureMessageThinkingSignature",
      "text",
      "cached",
      "hasToolUseInContents",
      "hasSignedThinkingInContents",
      "hasToolUseInMessages",
      "hasSignedThinkingInMessages",
      "ensureThinkingBeforeToolUseInMessages",
      "blocks",
      "hasToolUse",
      "thinkingBlocks",
      "otherBlocks",
      "hasSignedThinking",
      "lastThinking",
      "existingThinking",
      "thinkingText",
      "sentinelBlock",
      "injected",
      "getPluginSessionId",
      "generateSyntheticProjectId",
      "adjectives",
      "nouns",
      "adj",
      "noun",
      "randomPart",
      "STREAM_ACTION",
      "isGenerativeLanguageRequest",
      "PrepareRequestOptions",
      "prepareAntigravityRequest",
      "baseInit",
      "headers",
      "resolvedProjectId",
      "toolDebugMissing",
      "toolDebugSummaries",
      "toolDebugPayload",
      "sessionId",
      "needsSignedThinkingWarmup",
      "thinkingRecoveryMessage",
      "match",
      "requestedModel",
      "resolved",
      "effectiveModel",
      "streaming",
      "defaultEndpoint",
      "baseEndpoint",
      "transformedUrl",
      "isClaude",
      "isClaudeThinking",
      "tierThinkingBudget",
      "tierThinkingLevel",
      "signatureSessionKey",
      "body",
      "parsedBody",
      "isWrapped",
      "wrappedBody",
      "requestRoot",
      "requestObjects",
      "nested",
      "conversationKey",
      "modelForCacheKey",
      "req",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "requestPayload",
      "rawGenerationConfig",
      "extraBody",
      "variantConfig",
      "isGemini3",
      "toolConfig",
      "isImageModel",
      "userThinkingConfig",
      "hasAssistantHistory",
      "isClaudeSonnetNonThinking",
      "effectiveUserThinkingConfig",
      "imageConfig",
      "generationConfig",
      "finalThinkingConfig",
      "normalizedThinking",
      "thinkingBudget",
      "thinkingConfig",
      "currentMax",
      "generationConfig",
      "hint",
      "existing",
      "sys",
      "partsValue",
      "parts",
      "appended",
      "i",
      "part",
      "partRecord",
      "text",
      "cachedContentFromExtra",
      "cachedContent",
      "functionDeclarations",
      "passthroughTools",
      "normalizeSchema",
      "createPlaceholderSchema",
      "cleaned",
      "hasProperties",
      "pushDeclaration",
      "schema",
      "name",
      "description",
      "finalTools",
      "effectiveSearchConfig",
      "geminiResult",
      "enableToolHardening",
      "conversationKey",
      "hasToolUse",
      "hasSignedThinking",
      "hasCachedThinking",
      "toolCallCounter",
      "pendingCallIdsByName",
      "newParts",
      "call",
      "nameKey",
      "queue",
      "newParts",
      "resp",
      "queue",
      "conversationState",
      "effectiveProjectId",
      "existingSystemInstruction",
      "sys",
      "firstPart",
      "wrappedBody",
      "error",
      "existing",
      "interleavedHeader",
      "selectedHeaders",
      "buildThinkingWarmupBody",
      "parsed",
      "warmupPrompt",
      "updateRequest",
      "generationConfig",
      "nested",
      "transformAntigravityResponse",
      "contentType",
      "isJsonResponse",
      "isEventStreamResponse",
      "debugText",
      "cacheSignatures",
      "headers",
      "streamingTransformer",
      "headers",
      "text",
      "errorBody",
      "debugInfo",
      "injectedDebug",
      "errorType",
      "recoveryError",
      "errorMessage",
      "retryInfo",
      "match",
      "retrySeconds",
      "retryAfterSec",
      "retryAfterMs",
      "init",
      "usageFromSse",
      "parsed",
      "patched",
      "effectiveBody",
      "usage",
      "responseBody",
      "transformed",
      "error",
      "__testExports"
    ],
    "complexity_score": 100
  }
}