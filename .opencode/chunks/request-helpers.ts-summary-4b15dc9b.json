{
  "id": "request-helpers.ts-summary-4b15dc9b",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-google-antigravity-auth/src/plugin/request-helpers.ts",
  "chunk_type": "summary",
  "content": "# Summary: request-helpers.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (16)\n- **getSessionId**: No documentation found\n- **generateRequestId**: No documentation found\n- **applyAntigravitySystemInstruction**: No documentation found\n- **normalizeThinkingConfig**: Normalizes thinkingConfig - passes through values as-is without mapping.\nUser should use thinkingLevel for Gemini 3 and thinkingBudget for Gemini 2.5.\n- **parseGeminiApiBody**: Parses a Gemini API body; handles array-wrapped responses the API sometimes returns.\n- **extractUsageMetadata**: Extracts usageMetadata from a response object, guarding types.\n- **extractUsageFromSsePayload**: Walks SSE lines to find a usage-bearing response chunk.\n- **rewriteGeminiPreviewAccessError**: Enhances 404 errors for Gemini 3 models with a direct preview-access message.\n- **needsPreviewAccessOverride**: No documentation found\n- **rewriteGeminiRateLimitError**: Enhanced error handling for rate limits (429/Resource Exhausted).\nExtracts quota reset time and formats a friendly message.\n- **isGeminiThreeModel**: No documentation found\n- **toUrlString**: No documentation found\n- **safeJsonParse**: No documentation found\n- **recursivelyParseJsonStrings**: No documentation found\n- **processEscapeSequencesOnly**: Processes a value by only unescaping control characters (like \\n, \\t).\nIt does NOT attempt to parse JSON objects from strings.\n- **normalizeToolCallArgs**: Normalizes tool call arguments based on their schema.\n- If schema says string: only unescape control characters, don't parse as JSON.\n- If schema says array/object: attempt to parse string as JSON.\n- If no schema: fallback to processEscapeSequencesOnly.\n\n\n\n\n## Dependencies\n- node:crypto\n- ./tool-schema-cache\n\n## Exports\n- getSessionId\n- generateRequestId\n- ANTIGRAVITY_BASE_SYSTEM_INSTRUCTION\n- applyAntigravitySystemInstruction\n- GeminiApiError\n- GeminiApiBody\n- GeminiUsageMetadata\n- ThinkingConfig\n- normalizeThinkingConfig\n- parseGeminiApiBody\n- extractUsageMetadata\n- extractUsageFromSsePayload\n- rewriteGeminiPreviewAccessError\n- rewriteGeminiRateLimitError\n- toUrlString\n- recursivelyParseJsonStrings\n- processEscapeSequencesOnly\n- normalizeToolCallArgs\n\n## Complexity Metrics\n- Lines of code: 451\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.224Z",
    "updated_at": "2026-01-30T05:26:52.224Z",
    "hash": "b43fbd33de2506a9fccc379fa7293ee13a99d78e967c42679b4145eaaeb24632",
    "dependencies": [
      "node:crypto",
      "./tool-schema-cache"
    ],
    "symbols": [
      "SESSION_ID",
      "getSessionId",
      "generateRequestId",
      "ANTIGRAVITY_BASE_SYSTEM_INSTRUCTION",
      "applyAntigravitySystemInstruction",
      "normalizedModel",
      "needsInjection",
      "existing",
      "existingParts",
      "existingRecord",
      "parts",
      "nextParts",
      "GEMINI_PREVIEW_LINK",
      "GeminiApiError",
      "GeminiApiBody",
      "GeminiUsageMetadata",
      "ThinkingConfig",
      "normalizeThinkingConfig",
      "record",
      "budgetRaw",
      "levelRaw",
      "includeRaw",
      "thinkingBudget",
      "thinkingLevel",
      "includeThoughts",
      "normalized",
      "parseGeminiApiBody",
      "parsed",
      "firstObject",
      "extractUsageMetadata",
      "usage",
      "asRecord",
      "toNumber",
      "extractUsageFromSsePayload",
      "lines",
      "line",
      "jsonText",
      "parsed",
      "usage",
      "rewriteGeminiPreviewAccessError",
      "error",
      "trimmedMessage",
      "messagePrefix",
      "enhancedMessage",
      "needsPreviewAccessOverride",
      "errorMessage",
      "ErrorDetail",
      "rewriteGeminiRateLimitError",
      "error",
      "isRateLimit",
      "message",
      "isGeminiThreeModel",
      "toUrlString",
      "candidate",
      "safeJsonParse",
      "recursivelyParseJsonStrings",
      "record",
      "stripped",
      "hasControlCharEscapes",
      "hasIntentionalEscapes",
      "unescaped",
      "isWellFormed",
      "parsed",
      "lastBracket",
      "cleaned",
      "parsed",
      "lastBrace",
      "cleaned",
      "parsed",
      "processEscapeSequencesOnly",
      "hasControlCharEscapes",
      "hasIntentionalEscapes",
      "unescaped",
      "normalizeToolCallArgs",
      "record",
      "result",
      "expectedType",
      "parsed"
    ],
    "complexity_score": 100
  }
}