{
  "id": "plugin.ts-summary-41ec5edb",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-antigravity-auth/src/plugin.ts",
  "chunk_type": "summary",
  "content": "# Summary: plugin.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nDocumented purpose found in JSDoc\n\n## Key Components\n\n### Functions (36)\n- **getCapacityBackoffDelay**: No documentation found\n- **trackWarmupAttempt**: No documentation found\n- **getWarmupAttemptCount**: No documentation found\n- **markWarmupSuccess**: No documentation found\n- **clearWarmupAttempt**: No documentation found\n- **isWSL**: No documentation found\n- **isWSL2**: No documentation found\n- **isRemoteEnvironment**: No documentation found\n- **shouldSkipLocalServer**: No documentation found\n- **openBrowser**: No documentation found\n- **promptOAuthCallbackValue**: No documentation found\n- **getStateFromAuthorizationUrl**: No documentation found\n- **extractOAuthCallbackParams**: No documentation found\n- **parseOAuthCallbackInput**: No documentation found\n- **promptManualOAuthInput**: No documentation found\n- **clampInt**: No documentation found\n- **persistAccountPool**: No documentation found\n- **retryAfterMsFromResponse**: No documentation found\n- **parseDurationToMs**: No documentation found\n- **extractRateLimitBodyInfo**: No documentation found\n- **extractRetryInfoFromBody**: No documentation found\n- **formatWaitTime**: No documentation found\n- **getRateLimitBackoff**: Get rate limit backoff with time-window deduplication.\n- **resetRateLimitState**: Reset rate limit state for an account+quota combination.\nOnly resets the specific quota, not all quotas for the account.\n- **resetAllRateLimitStateForAccount**: Reset all rate limit state for an account (all quotas).\nUsed when account is completely healthy.\n- **headerStyleToQuotaKey**: No documentation found\n- **trackAccountFailure**: No documentation found\n- **resetAccountFailureState**: No documentation found\n- **sleep**: Sleep for a given number of milliseconds, respecting an abort signal.\n- **toUrlString**: No documentation found\n- **toWarmupStreamUrl**: No documentation found\n- **extractModelFromUrl**: No documentation found\n- **extractModelFromUrlWithSuffix**: No documentation found\n- **getModelFamilyFromUrl**: No documentation found\n- **getHeaderStyleFromUrl**: No documentation found\n- **isExplicitQuotaFromUrl**: No documentation found\n\n\n\n\n## Dependencies\n- node:child_process\n- ./constants\n- ./antigravity/oauth\n- ./antigravity/oauth\n- ./plugin/auth\n- ./plugin/cli\n- ./plugin/project\n- ./plugin/debug\n- ./plugin/request\n- ./plugin/transform/model-resolver\n- ./plugin/request-helpers\n- ./plugin/errors\n- ./plugin/token\n- ./plugin/server\n- ./plugin/storage\n- ./plugin/accounts\n- ./hooks/auto-update-checker\n- ./plugin/config\n- ./plugin/recovery\n- ./plugin/cache\n- ./plugin/refresh-queue\n- ./plugin/logger\n- ./plugin/rotation\n- ./plugin/types\n\n## Exports\n- createAntigravityPlugin\n- AntigravityCLIOAuthPlugin\n- GoogleOAuthPlugin\n\n## Complexity Metrics\n- Lines of code: 2071\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.123Z",
    "updated_at": "2026-01-30T05:26:52.123Z",
    "hash": "532266fca30a14aba42a68271ee62df862ea088dcabbc45591acadd674434365",
    "dependencies": [
      "node:child_process",
      "./constants",
      "./antigravity/oauth",
      "./antigravity/oauth",
      "./plugin/auth",
      "./plugin/cli",
      "./plugin/project",
      "./plugin/debug",
      "./plugin/request",
      "./plugin/transform/model-resolver",
      "./plugin/request-helpers",
      "./plugin/errors",
      "./plugin/token",
      "./plugin/server",
      "./plugin/storage",
      "./plugin/accounts",
      "./hooks/auto-update-checker",
      "./plugin/config",
      "./plugin/recovery",
      "./plugin/cache",
      "./plugin/refresh-queue",
      "./plugin/logger",
      "./plugin/rotation",
      "./plugin/types"
    ],
    "symbols": [
      "MAX_OAUTH_ACCOUNTS",
      "MAX_WARMUP_SESSIONS",
      "MAX_WARMUP_RETRIES",
      "CAPACITY_BACKOFF_TIERS_MS",
      "getCapacityBackoffDelay",
      "index",
      "warmupAttemptedSessionIds",
      "warmupSucceededSessionIds",
      "log",
      "trackWarmupAttempt",
      "first",
      "attempts",
      "getWarmupAttemptCount",
      "markWarmupSuccess",
      "first",
      "clearWarmupAttempt",
      "isWSL",
      "release",
      "isWSL2",
      "version",
      "isRemoteEnvironment",
      "shouldSkipLocalServer",
      "openBrowser",
      "promptOAuthCallbackValue",
      "rl",
      "OAuthCallbackParams",
      "getStateFromAuthorizationUrl",
      "extractOAuthCallbackParams",
      "code",
      "state",
      "parseOAuthCallbackInput",
      "trimmed",
      "url",
      "code",
      "state",
      "promptManualOAuthInput",
      "callbackInput",
      "params",
      "clampInt",
      "persistAccountPool",
      "now",
      "stored",
      "accounts",
      "indexByRefreshToken",
      "indexByEmail",
      "i",
      "acc",
      "result",
      "parts",
      "existingByEmail",
      "existingByToken",
      "existingIndex",
      "newIndex",
      "existing",
      "oldToken",
      "activeIndex",
      "retryAfterMsFromResponse",
      "retryAfterMsHeader",
      "parsed",
      "retryAfterHeader",
      "parsed",
      "parseDurationToMs",
      "match",
      "value",
      "unit",
      "RateLimitBodyInfo",
      "extractRateLimitBodyInfo",
      "error",
      "message",
      "details",
      "reason",
      "detail",
      "type",
      "detailReason",
      "detail",
      "type",
      "retryDelay",
      "retryDelayMs",
      "detail",
      "metadata",
      "quotaResetDelay",
      "quotaResetTime",
      "quotaResetDelayMs",
      "afterMatch",
      "rawDuration",
      "parsed",
      "extractRetryInfoFromBody",
      "text",
      "parsed",
      "formatWaitTime",
      "seconds",
      "minutes",
      "remainingSeconds",
      "hours",
      "remainingMinutes",
      "FIRST_RETRY_DELAY_MS",
      "SWITCH_ACCOUNT_DELAY_MS",
      "RATE_LIMIT_DEDUP_WINDOW_MS",
      "RATE_LIMIT_STATE_RESET_MS",
      "RateLimitState",
      "rateLimitStateByAccountQuota",
      "emptyResponseAttempts",
      "getRateLimitBackoff",
      "now",
      "stateKey",
      "previous",
      "baseDelay",
      "backoffDelay",
      "attempt",
      "baseDelay",
      "backoffDelay",
      "resetRateLimitState",
      "stateKey",
      "resetAllRateLimitStateForAccount",
      "key",
      "headerStyleToQuotaKey",
      "accountFailureState",
      "MAX_CONSECUTIVE_FAILURES",
      "FAILURE_COOLDOWN_MS",
      "FAILURE_STATE_RESET_MS",
      "trackAccountFailure",
      "now",
      "previous",
      "failures",
      "shouldCooldown",
      "cooldownMs",
      "resetAccountFailureState",
      "sleep",
      "timeout",
      "onAbort",
      "cleanup",
      "createAntigravityPlugin",
      "config",
      "sessionRecovery",
      "updateChecker",
      "eventHandler",
      "props",
      "sessionID",
      "messageID",
      "error",
      "messageInfo",
      "recovered",
      "successToast",
      "auth",
      "authParts",
      "storedAccounts",
      "accountManager",
      "refreshQueue",
      "logPath",
      "model",
      "latestAuth",
      "urlString",
      "family",
      "model",
      "debugLines",
      "pushDebug",
      "FailureContext",
      "lastFailure",
      "lastError",
      "abortSignal",
      "checkAborted",
      "showToast",
      "quietMode",
      "hasOtherAccountWithAntigravity",
      "otherAccounts",
      "accountCount",
      "account",
      "waitMs",
      "waitSecValue",
      "maxWaitMs",
      "waitTimeFormatted",
      "accountLabel",
      "authRecord",
      "refreshed",
      "error",
      "error",
      "removed",
      "persistError",
      "storeError",
      "accessToken",
      "projectContext",
      "error",
      "error",
      "runThinkingWarmup",
      "warmupBody",
      "warmupUrl",
      "warmupHeaders",
      "warmupInit",
      "warmupDebugContext",
      "warmupResponse",
      "transformed",
      "error",
      "shouldSwitchAccount",
      "headerStyle",
      "explicitQuota",
      "alternateStyle",
      "quotaName",
      "altQuotaName",
      "forceThinkingRecovery",
      "tokenConsumed",
      "i",
      "currentEndpoint",
      "prepared",
      "originalUrl",
      "resolvedUrl",
      "debugContext",
      "response",
      "headerRetryMs",
      "bodyInfo",
      "serverRetryMs",
      "quotaKey",
      "rateLimitReason",
      "smartBackoffMs",
      "effectiveDelayMs",
      "isCapacityExhausted",
      "capacityBackoffMs",
      "backoffFormatted",
      "failures",
      "accountLabel",
      "alternateStyle",
      "safeModelName",
      "quotaName",
      "quotaMsg",
      "expBackoffMs",
      "expBackoffFormatted",
      "quotaKey",
      "shouldRetryEndpoint",
      "cloned",
      "bodyText",
      "errorMessage",
      "maxAttempts",
      "retryDelayMs",
      "clonedForCheck",
      "bodyText",
      "emptyAttemptKey",
      "currentAttempts",
      "emptyAttemptKeyClean",
      "transformedResponse",
      "contextError",
      "error",
      "recoveryError",
      "originalError",
      "recoveryMessage",
      "isHeadless",
      "accounts",
      "noBrowser",
      "useManualMode",
      "startFresh",
      "existingStorage",
      "existingAccounts",
      "loginMode",
      "projectId",
      "result",
      "authorization",
      "fallbackState",
      "browserOpened",
      "listener",
      "SOFT_TIMEOUT_MS",
      "callbackPromise",
      "timeoutPromise",
      "callbackUrl",
      "err",
      "params",
      "error",
      "isFirstAccount",
      "currentAccountCount",
      "currentStorage",
      "addAnother",
      "primary",
      "actualAccountCount",
      "finalStorage",
      "projectId",
      "existingStorage",
      "existingCount",
      "useManualFlow",
      "listener",
      "authorization",
      "fallbackState",
      "browserOpened",
      "CALLBACK_TIMEOUT_MS",
      "callbackPromise",
      "timeoutPromise",
      "callbackUrl",
      "err",
      "params",
      "result",
      "newTotal",
      "toastMessage",
      "error",
      "params",
      "result",
      "newTotal",
      "toastMessage",
      "AntigravityCLIOAuthPlugin",
      "GoogleOAuthPlugin",
      "toUrlString",
      "candidate",
      "toWarmupStreamUrl",
      "urlString",
      "url",
      "extractModelFromUrl",
      "match",
      "extractModelFromUrlWithSuffix",
      "match",
      "getModelFamilyFromUrl",
      "model",
      "family",
      "getHeaderStyleFromUrl",
      "modelWithSuffix",
      "isExplicitQuotaFromUrl",
      "modelWithSuffix"
    ],
    "complexity_score": 100
  }
}