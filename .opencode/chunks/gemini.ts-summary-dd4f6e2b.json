{
  "id": "gemini.ts-summary-dd4f6e2b",
  "file_path": "/Users/user/opencode-autognosis/reference repos/opencode-google-antigravity-auth/src/plugin/transform/gemini.ts",
  "chunk_type": "summary",
  "content": "# Summary: gemini.ts\n\n## File Type\n.ts - TypeScript source file\n\n## Purpose\nPurpose not explicitly documented\n\n## Key Components\n\n### Functions (16)\n- **hasFunctionTools**: No documentation found\n- **extractSystemInstructionText**: No documentation found\n- **getToolCallingMode**: No documentation found\n- **getFunctionToolNames**: No documentation found\n- **hasInjectedToolSchemaInstruction**: No documentation found\n- **scrubToolTranscriptArtifacts**: No documentation found\n- **scrubConversationArtifactsFromModelHistory**: No documentation found\n- **injectSystemInstructionIfNeeded**: No documentation found\n- **normalizeSchemaType**: No documentation found\n- **summarizeSchema**: No documentation found\n- **buildStrictParamsSummary**: No documentation found\n- **augmentToolDescriptionsWithStrictParams**: No documentation found\n- **sanitizeToolNameForGemini**: Sanitizes tool names for Gemini API compatibility.\nGemini requires tool names to match: ^[a-zA-Z_][a-zA-Z0-9_-]*$\nThis means names cannot start with numbers.\n- **sanitizeToolNames**: Recursively sanitizes all tool names in the request payload.\n- **transformGeminiRequest**: Transforms a request payload for native Gemini models.\n\nHandles common transformations:\n- Removes `safetySettings` (Antigravity manages these)\n- Sets `toolConfig.functionCallingConfig.mode` to \"VALIDATED\"\n- Normalizes `thinkingConfig` for Gemini 2.5/3 models\n- Extracts and normalizes `cachedContent` from various locations\n- Wraps payload with Antigravity metadata (project, userAgent, requestId, sessionId)\n- **countTools**: No documentation found\n\n\n\n\n## Dependencies\n- ../cache\n- ../logger\n- ../request-helpers\n- ../tool-schema-cache\n- ./types\n\n## Exports\n- transformGeminiRequest\n\n## Complexity Metrics\n- Lines of code: 695\n- Estimated complexity: 100/100\n\n## Notes\nNo specific notes found",
  "metadata": {
    "created_at": "2026-01-30T05:26:52.256Z",
    "updated_at": "2026-01-30T05:26:52.256Z",
    "hash": "a2915c55297a59b531952fa30f187d3e6cb79a542363e16bbb7f977cd8b09a0c",
    "dependencies": [
      "../cache",
      "../logger",
      "../request-helpers",
      "../tool-schema-cache",
      "./types"
    ],
    "symbols": [
      "log",
      "THOUGHT_SIGNATURE_BYPASS",
      "GEMINI_TOOL_SCHEMA_SYSTEM_INSTRUCTION",
      "hasFunctionTools",
      "tools",
      "extractSystemInstructionText",
      "parts",
      "getToolCallingMode",
      "toolConfig",
      "functionCallingConfig",
      "mode",
      "getFunctionToolNames",
      "tools",
      "names",
      "tool",
      "funcDecls",
      "funcDecl",
      "name",
      "hasInjectedToolSchemaInstruction",
      "existingText",
      "ScrubResult",
      "scrubToolTranscriptArtifacts",
      "lines",
      "output",
      "removedLines",
      "removedBlocks",
      "inFence",
      "fenceStart",
      "fenceLines",
      "isMarkerLine",
      "line",
      "isFence",
      "hadMarker",
      "cleanedFenceLines",
      "fenceLine",
      "hasNonWhitespace",
      "cleaned",
      "scrubConversationArtifactsFromModelHistory",
      "contents",
      "scrubbedParts",
      "removedLines",
      "removedBlocks",
      "content",
      "parts",
      "part",
      "scrubbed",
      "injectSystemInstructionIfNeeded",
      "existingText",
      "existing",
      "suffix",
      "asRecord",
      "parts",
      "normalizeSchemaType",
      "nonNull",
      "first",
      "summarizeSchema",
      "record",
      "normalizedType",
      "enumValues",
      "items",
      "itemSummary",
      "props",
      "required",
      "keys",
      "requiredKeys",
      "optionalKeys",
      "orderedKeys",
      "maxPropsToShow",
      "shownKeys",
      "inner",
      "propSchema",
      "propType",
      "requiredSuffix",
      "extraCount",
      "extra",
      "preview",
      "suffix",
      "buildStrictParamsSummary",
      "schemaType",
      "properties",
      "required",
      "keys",
      "requiredKeys",
      "optionalKeys",
      "orderedKeys",
      "parts",
      "propSchema",
      "typeSummary",
      "requiredSuffix",
      "summary",
      "maxLen",
      "augmentToolDescriptionsWithStrictParams",
      "tools",
      "augmented",
      "toolNames",
      "tool",
      "funcDecls",
      "funcDecl",
      "schema",
      "currentDescription",
      "summary",
      "nextDescription",
      "sanitizeToolNameForGemini",
      "sanitizeToolNames",
      "tools",
      "tool",
      "funcDecls",
      "func",
      "originalName",
      "transformGeminiRequest",
      "requestPayload",
      "toolConfig",
      "rawGenerationConfig",
      "normalizedThinking",
      "cachedContentFromExtra",
      "cachedContent",
      "contents",
      "contentIndex",
      "content",
      "parts",
      "filteredParts",
      "thinkingBlocksRemoved",
      "removedThoughtSignatures",
      "addedFunctionCallThoughtSignatures",
      "currentThoughtSignature",
      "partIndex",
      "part",
      "thoughtText",
      "cachedSig",
      "functionCall",
      "callName",
      "existingSig",
      "source",
      "nextSig",
      "wrappedBody",
      "toolCount",
      "toolCallingMode",
      "systemInstructionHasMarker",
      "functionToolNames",
      "contentsCount",
      "body",
      "countTools",
      "tools",
      "count",
      "tool",
      "funcDecls"
    ],
    "complexity_score": 100
  }
}